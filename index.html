<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 98 - Полная виртуальная машина</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=MS+Sans+Serif:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        input, textarea, .selectable {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        body {
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            background: #000;
            color: #000;
            overflow: hidden;
            cursor: default;
        }

        /* Экран входа в систему */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #008080;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-window {
            width: 400px;
            height: 300px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.5);
        }

        .login-titlebar {
            height: 22px;
            background: linear-gradient(to right, #0054e3, #1084d0);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 6px;
            font-weight: bold;
            font-size: 11px;
        }

        .login-content {
            padding: 30px;
            text-align: center;
        }

        .login-icon {
            width: 64px;
            height: 64px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="20" r="12" fill="%23333"/><path d="M32 36c-12 0-22 8-22 18h44c0-10-10-18-22-18z" fill="%23333"/></svg>');
            background-size: contain;
            margin: 0 auto 20px;
        }

        .login-user {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .login-password {
            width: 200px;
            height: 22px;
            padding: 2px 6px;
            border: 1px inset #c0c0c0;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            margin-bottom: 20px;
        }

        .login-button {
            width: 75px;
            height: 23px;
            background: linear-gradient(to bottom, #c0c0c0, #a0a0a0);
            border: 1px outset #c0c0c0;
            cursor: pointer;
            font-size: 11px;
            margin: 0 5px;
        }

        .login-button:hover {
            background: linear-gradient(to bottom, #d0d0d0, #b0b0b0);
        }

        .login-button:active {
            border: 1px inset #c0c0c0;
            background: linear-gradient(to bottom, #b0b0b0, #909090);
        }

        .login-error {
            color: #ff0000;
            font-size: 10px;
            margin-top: 10px;
        }

        /* BIOS и загрузка */
        .bios-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            z-index: 10002;
            padding: 20px;
            animation: biosSequence 4s forwards;
        }

        @keyframes biosSequence {
            0% { opacity: 1; }
            85% { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }
        }

        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000080;
            color: #fff;
            font-family: 'MS Sans Serif', sans-serif;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: bootScreen 6s forwards;
        }

        @keyframes bootScreen {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }
        }

        .windows-logo {
            width: 400px;
            height: 200px;
            background: linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #0000ff);
            border: 3px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 40px;
        }

        .boot-progress {
            width: 500px;
            height: 30px;
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            margin: 20px 0;
            overflow: hidden;
        }

        .boot-bar {
            height: 100%;
            background: linear-gradient(90deg, #0000ff, #00ffff);
            width: 0%;
            animation: bootProgress 4s ease-in-out forwards;
        }

        @keyframes bootProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* Рабочий стол */
        .desktop {
            width: 100vw;
            height: 100vh;
            background: #008080;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%23008080"/><pattern id="grid" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="%23006060" stroke-width="0.5" opacity="0.3"/></pattern><rect width="100%" height="100%" fill="url(%23grid)"/></svg>');
            position: relative;
            overflow: hidden;
            display: none;
        }

        .desktop.show {
            display: block;
        }

        /* Панель задач */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px;
            background: linear-gradient(to bottom, #c0c0c0 0%, #a0a0a0 50%, #808080 100%);
            border-top: 1px solid #dfdfdf;
            display: flex;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.3);
        }

        .start-button {
            height: 26px;
            padding: 0 12px;
            background: linear-gradient(to bottom, #c0c0c0, #a0a0a0);
            border: 1px outset #c0c0c0;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            margin: 2px;
            font-size: 11px;
        }

        .start-button:hover {
            background: linear-gradient(to bottom, #d0d0d0, #b0b0b0);
        }

        .start-button:active {
            border: 1px inset #c0c0c0;
            background: linear-gradient(to bottom, #a0a0a0, #808080);
        }

        .start-button::before {
            content: "⊞";
            font-size: 14px;
            color: #000080;
            font-weight: bold;
        }

        .quick-launch {
            display: flex;
            align-items: center;
            gap: 2px;
            margin: 0 4px;
            padding: 2px 4px;
            border-right: 1px solid #808080;
        }

        .quick-launch-icon {
            width: 20px;
            height: 20px;
            background: #c0c0c0;
            border: 1px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .quick-launch-icon:hover {
            border: 1px outset #c0c0c0;
            background: #d0d0d0;
        }

        .quick-launch-icon:active {
            border: 1px inset #c0c0c0;
        }

        .task-list {
            flex: 1;
            height: 100%;
            display: flex;
            align-items: center;
            padding: 0 4px;
            gap: 2px;
        }

        .task-item {
            height: 24px;
            padding: 0 8px;
            background: linear-gradient(to bottom, #c0c0c0, #a0a0a0);
            border: 1px outset #c0c0c0;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 10px;
            min-width: 120px;
            max-width: 160px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .task-item.active {
            border: 1px inset #c0c0c0;
            background: linear-gradient(to bottom, #a0a0a0, #808080);
        }

        .system-tray {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 8px;
            border-left: 1px solid #808080;
        }

        .tray-icon {
            width: 16px;
            height: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .clock {
            font-size: 10px;
            padding: 2px 4px;
            border: 1px inset #c0c0c0;
            background: #c0c0c0;
            min-width: 50px;
            text-align: center;
        }

        /* Иконки рабочего стола */
        .desktop-icons {
            position: absolute;
            top: 10px;
            left: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, 75px);
            gap: 15px;
            width: 400px;
        }

        .desktop-icon {
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 4px;
            border-radius: 2px;
            transition: background 0.2s;
        }

        .desktop-icon:hover {
            background: rgba(255,255,255,0.2);
        }

        .desktop-icon.selected {
            background: #316ac5;
            color: white;
        }

        .icon-image {
            width: 32px;
            height: 32px;
            font-size: 24px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-label {
            font-size: 10px;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            word-wrap: break-word;
            line-height: 1.2;
        }

        /* Окна */
        .window {
            position: absolute;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            min-width: 300px;
            min-height: 200px;
            display: none;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            z-index: 100;
            resize: both;
            overflow: hidden;
        }

        .window.active {
            z-index: 200;
        }

        .window-titlebar {
            height: 22px;
            background: linear-gradient(to right, #0054e3, #1084d0);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 6px;
            cursor: move;
            font-weight: bold;
            font-size: 11px;
        }

        .window.inactive .window-titlebar {
            background: linear-gradient(to right, #808080, #a0a0a0);
        }

        .window-icon {
            width: 16px;
            height: 16px;
            margin-right: 4px;
            font-size: 12px;
        }

        .window-title {
            flex: 1;
            padding-left: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .window-controls {
            display: flex;
            gap: 2px;
        }

        .window-control {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 8px;
            font-weight: bold;
        }

        .window-control:hover {
            background: #d0d0d0;
        }

        .window-control:active {
            border: 1px inset #c0c0c0;
            background: #a0a0a0;
        }

        .window-menubar {
            height: 20px;
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 4px;
        }

        .menu-item {
            padding: 2px 8px;
            cursor: pointer;
            font-size: 10px;
            position: relative;
        }

        .menu-item:hover {
            background: #316ac5;
            color: white;
        }

        .window-content {
            flex: 1;
            overflow: auto;
            padding: 8px;
            background: #c0c0c0;
            display: flex;
            flex-direction: column;
        }

        .window-statusbar {
            height: 18px;
            background: #c0c0c0;
            border-top: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 4px;
            font-size: 10px;
        }

        .status-panel {
            border: 1px inset #c0c0c0;
            padding: 1px 4px;
            margin-right: 4px;
            min-width: 80px;
            text-align: center;
        }

        /* Браузер - ИСПРАВЛЕН */
        .browser {
            width: 900px;
            height: 650px;
        }

        .browser-toolbar {
            height: 30px;
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 4px;
            gap: 4px;
        }

        .toolbar-button {
            width: 24px;
            height: 24px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .toolbar-button:hover {
            background: #d0d0d0;
        }

        .toolbar-button:active {
            border: 1px inset #c0c0c0;
            background: #a0a0a0;
        }

        .browser-addressbar {
            height: 26px;
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 4px;
            gap: 4px;
        }

        .address-input {
            flex: 1;
            height: 20px;
            padding: 2px 4px;
            border: 1px inset #c0c0c0;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 10px;
            background: white;
        }

        .browser-frame {
            width: 100%;
            height: 100%;
            border: 1px inset #c0c0c0;
            background: white;
            overflow: hidden;
        }

        .browser-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        .browser-content {
            padding: 10px;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 12px;
            line-height: 1.4;
            height: 100%;
            overflow-y: auto;
        }

        .webpage h1 {
            color: #000080;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .webpage h2 {
            color: #800000;
            font-size: 14px;
            margin: 10px 0 5px 0;
        }

        .webpage p {
            margin-bottom: 10px;
        }

        .webpage a {
            color: #0000ff;
            text-decoration: underline;
            cursor: pointer;
        }

        .webpage a:visited {
            color: #800080;
        }

        .webpage a:hover {
            background: #ffff00;
        }

        /* Магазин приложений */
        .app-store {
            width: 800px;
            height: 600px;
        }

        .store-toolbar {
            height: 30px;
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 8px;
            gap: 8px;
        }

        .store-search {
            flex: 1;
            height: 20px;
            padding: 2px 4px;
            border: 1px inset #c0c0c0;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 10px;
        }

        .store-content {
            display: flex;
            height: calc(100% - 30px);
        }

        .store-categories {
            width: 150px;
            background: #c0c0c0;
            border-right: 1px solid #808080;
            overflow-y: auto;
        }

        .store-category {
            padding: 6px 8px;
            cursor: pointer;
            font-size: 10px;
            border-bottom: 1px solid #a0a0a0;
        }

        .store-category:hover {
            background: #d0d0d0;
        }

        .store-category.active {
            background: #316ac5;
            color: white;
        }

        .store-apps {
            flex: 1;
            background: white;
            overflow-y: auto;
            padding: 8px;
        }

        .app-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 1px solid #e0e0e0;
            margin-bottom: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .app-item:hover {
            background: #f0f0f0;
        }

        .app-icon {
            width: 48px;
            height: 48px;
            margin-right: 12px;
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #c0c0c0;
            background: #f8f8f8;
        }

        .app-info {
            flex: 1;
        }

        .app-name {
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .app-developer {
            color: #666;
            font-size: 10px;
            margin-bottom: 2px;
        }

        .app-description {
            font-size: 10px;
            color: #333;
            line-height: 1.3;
        }

        .app-actions {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .app-button {
            padding: 4px 12px;
            background: linear-gradient(to bottom, #c0c0c0, #a0a0a0);
            border: 1px outset #c0c0c0;
            cursor: pointer;
            font-size: 10px;
            text-align: center;
            min-width: 80px;
        }

        .app-button:hover {
            background: linear-gradient(to bottom, #d0d0d0, #b0b0b0);
        }

        .app-button:active {
            border: 1px inset #c0c0c0;
            background: linear-gradient(to bottom, #b0b0b0, #909090);
        }

        .app-button.installed {
            background: linear-gradient(to bottom, #80ff80, #60ff60);
        }

        .app-rating {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }

        /* Игровые элементы */
        .game-canvas {
            border: 1px inset #c0c0c0;
            background: #000;
            display: block;
            margin: 0 auto;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
        }

        .game-score {
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            margin: 10px 0;
        }

        /* Медиа элементы */
        .media-display {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            text-align: center;
            padding: 20px;
            border: 1px inset #c0c0c0;
            margin: 10px 0;
        }

        .media-controls {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin: 10px 0;
        }

        .media-button {
            width: 32px;
            height: 28px;
            background: linear-gradient(to bottom, #e0e0e0, #c0c0c0);
            border: 1px outset #c0c0c0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .media-button:hover {
            background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
        }

        .media-button:active {
            border: 1px inset #c0c0c0;
            background: linear-gradient(to bottom, #d0d0d0, #b0b0b0);
        }

        /* Меню Пуск */
        .start-menu {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 250px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            display: none;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            z-index: 1001;
        }

        .start-menu.show {
            display: block;
        }

        .start-menu-header {
            height: 50px;
            background: linear-gradient(to right, #000080, #0080ff);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-weight: bold;
            font-size: 16px;
        }

        .start-menu-items {
            max-height: 400px;
            overflow-y: auto;
        }

        .start-menu-item {
            padding: 6px 10px;
            cursor: pointer;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .start-menu-item:hover {
            background: #316ac5;
            color: white;
        }

        .start-menu-separator {
            height: 1px;
            background: #808080;
            margin: 2px 0;
        }

        .start-menu-icon {
            width: 16px;
            height: 16px;
            font-size: 12px;
        }

        /* Калькулятор */
        .calculator {
            width: 280px;
            height: 350px;
        }

        .calc-display {
            height: 40px;
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            text-align: right;
            padding: 0 8px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin: 8px;
            border: 2px inset #c0c0c0;
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            padding: 8px;
        }

        .calc-button {
            height: 35px;
            background: linear-gradient(to bottom, #e0e0e0, #c0c0c0);
            border: 1px outset #c0c0c0;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calc-button:hover {
            background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
        }

        .calc-button:active {
            border: 1px inset #c0c0c0;
            background: linear-gradient(to bottom, #d0d0d0, #b0b0b0);
        }

        .calc-button.operator {
            background: linear-gradient(to bottom, #ff8080, #ff6060);
            color: white;
        }

        .calc-button.equals {
            background: linear-gradient(to bottom, #80ff80, #60ff60);
        }

        /* Диалоговые окна */
        .dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            z-index: 1003;
            display: none;
            min-width: 300px;
        }

        .dialog.show {
            display: block;
        }

        .dialog-titlebar {
            height: 20px;
            background: linear-gradient(to right, #0054e3, #1084d0);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 6px;
            font-weight: bold;
            font-size: 11px;
        }

        .dialog-content {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .dialog-icon {
            width: 32px;
            height: 32px;
            font-size: 28px;
        }

        .dialog-text {
            flex: 1;
            font-size: 11px;
            line-height: 1.4;
        }

        .dialog-buttons {
            padding: 10px 20px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            border-top: 1px solid #808080;
        }

        .dialog-button {
            padding: 6px 16px;
            background: linear-gradient(to bottom, #c0c0c0, #a0a0a0);
            border: 1px outset #c0c0c0;
            cursor: pointer;
            font-size: 11px;
            min-width: 75px;
        }

        .dialog-button:hover {
            background: linear-gradient(to bottom, #d0d0d0, #b0b0b0);
        }

        .dialog-button:active {
            border: 1px inset #c0c0c0;
            background: linear-gradient(to bottom, #b0b0b0, #909090);
        }

        /* Уведомления */
        .notification {
            position: fixed;
            bottom: 40px;
            right: 10px;
            background: #ffffcc;
            border: 2px outset #c0c0c0;
            padding: 8px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 1004;
            display: none;
            font-size: 10px;
            max-width: 250px;
        }

        .notification.show {
            display: block;
        }

        /* Анимации */
        @keyframes windowAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .window.opening {
            animation: windowAppear 0.2s ease-out;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            .window {
                width: 95vw !important;
                height: 80vh !important;
                top: 10px !important;
                left: 2.5vw !important;
            }
            
            .start-menu {
                width: 200px;
            }
            
            .desktop-icons {
                grid-template-columns: repeat(4, 1fr);
                width: 280px;
            }
        }
    </style>
</head>
<body>
    <!-- BIOS экран -->
    <div class="bios-screen" id="biosScreen">
        <div style="color: #ffffff; font-weight: bold; margin-bottom: 20px;">Award Modular BIOS v4.51PG</div>
        <div>Detecting Primary Master ... IDE Hard Drive</div>
        <div>Detecting Primary Slave ... Not Detected</div>
        <div>Detecting Secondary Master ... ATAPI CD-ROM</div>
        <div>Detecting Secondary Slave ... Not Detected</div>
        <div>Memory Test : 65536K OK</div>
        <div>Primary Master : ST3160023A</div>
        <div>Starting Windows 98...</div>
        <div style="animation: blink 1s infinite;">_</div>
    </div>

    <!-- Загрузочный экран -->
    <div class="boot-screen" id="bootScreen">
        <div class="windows-logo">Microsoft Windows 98</div>
        <div style="color: #fff; font-size: 16px; margin-bottom: 20px;">Starting Windows...</div>
        <div class="boot-progress">
            <div class="boot-bar"></div>
        </div>
    </div>

    <!-- Экран входа -->
    <div class="login-screen" id="loginScreen">
        <div class="login-window">
            <div class="login-titlebar">
                <span>Вход в Windows</span>
            </div>
            <div class="login-content">
                <div class="login-icon"></div>
                <div class="login-user">Andrey</div>
                <div>Введите пароль:</div>
                <input type="password" class="login-password" id="passwordInput" placeholder="Пароль">
                <div>
                    <button class="login-button" onclick="login()">OK</button>
                    <button class="login-button" onclick="cancelLogin()">Отмена</button>
                </div>
                <div class="login-error" id="loginError"></div>
            </div>
        </div>
    </div>

    <!-- Рабочий стол -->
    <div class="desktop" id="desktop">
        <!-- Иконки рабочего стола -->
        <div class="desktop-icons">
            <div class="desktop-icon" data-app="browser">
                <div class="icon-image">🌐</div>
                <div class="icon-label">Internet Explorer</div>
            </div>
            <div class="desktop-icon" data-app="filemanager">
                <div class="icon-image">📁</div>
                <div class="icon-label">Мой компьютер</div>
            </div>
            <div class="desktop-icon" data-app="calculator">
                <div class="icon-image">🔢</div>
                <div class="icon-label">Калькулятор</div>
            </div>
            <div class="desktop-icon" data-app="notepad">
                <div class="icon-image">📝</div>
                <div class="icon-label">Блокнот</div>
            </div>
            <div class="desktop-icon" data-app="paint">
                <div class="icon-image">🎨</div>
                <div class="icon-label">Paint</div>
            </div>
            <div class="desktop-icon" data-app="appstore">
                <div class="icon-image">🏪</div>
                <div class="icon-label">Магазин приложений</div>
            </div>
            <div class="desktop-icon" data-app="minesweeper">
                <div class="icon-image">💣</div>
                <div class="icon-label">Сапер</div>
            </div>
            <div class="desktop-icon" data-app="solitaire">
                <div class="icon-image">🃏</div>
                <div class="icon-label">Пасьянс</div>
            </div>
            <div class="desktop-icon" data-app="mediaplayer">
                <div class="icon-image">🎵</div>
                <div class="icon-label">Проигрыватель</div>
            </div>
            <div class="desktop-icon" data-app="terminal">
                <div class="icon-image">💻</div>
                <div class="icon-label">Командная строка</div>
            </div>
        </div>

        <!-- Окно браузера - ИСПРАВЛЕНО -->
        <div class="window browser" id="browserWindow">
            <div class="window-titlebar">
                <div class="window-icon">🌐</div>
                <div class="window-title">Microsoft Internet Explorer</div>
                <div class="window-controls">
                    <div class="window-control" data-action="minimize">_</div>
                    <div class="window-control" data-action="maximize">□</div>
                    <div class="window-control" data-action="close">×</div>
                </div>
            </div>
            <div class="window-menubar">
                <div class="menu-item">Файл</div>
                <div class="menu-item">Правка</div>
                <div class="menu-item">Вид</div>
                <div class="menu-item">Избранное</div>
                <div class="menu-item">Сервис</div>
                <div class="menu-item">Справка</div>
            </div>
            <div class="browser-toolbar">
                <div class="toolbar-button" onclick="browserAction('back')" title="Назад">⬅️</div>
                <div class="toolbar-button" onclick="browserAction('forward')" title="Вперед">➡️</div>
                <div class="toolbar-button" onclick="browserAction('stop')" title="Остановить">⏹️</div>
                <div class="toolbar-button" onclick="browserAction('refresh')" title="Обновить">🔄</div>
                <div class="toolbar-button" onclick="browserAction('home')" title="Домой">🏠</div>
                <div class="toolbar-button" onclick="browserAction('search')" title="Поиск">🔍</div>
                <div class="toolbar-button" onclick="browserAction('favorites')" title="Избранное">⭐</div>
            </div>
            <div class="browser-addressbar">
                <span style="font-size: 10px; margin-right: 4px;">Адрес:</span>
                <input type="text" class="address-input" id="addressInput" value="https://www.google.com" placeholder="Введите адрес">
                <div class="toolbar-button" onclick="navigateToUrl()">▶️</div>
            </div>
            <div class="window-content" style="padding: 0;">
                <div class="browser-frame" id="browserFrame">
                    <div class="browser-content">
                        <h1>🌐 Добро пожаловать в Internet Explorer</h1>
                        <p>Полнофункциональный браузер для Windows 98! Загружает реальные веб-сайты в полноэкранном режиме.</p>
                        
                        <h2>🔗 Быстрые ссылки:</h2>
                        <p>
                            <a href="#" onclick="navigateTo('https://www.google.com')">Google</a> |
                            <a href="#" onclick="navigateTo('https://www.youtube.com')">YouTube</a> |
                            <a href="#" onclick="navigateTo('https://www.wikipedia.org')">Wikipedia</a> |
                            <a href="#" onclick="navigateTo('https://www.github.com')">GitHub</a>
                        </p>
                        
                        <h2>🎯 Популярные сайты:</h2>
                        <ul>
                            <li><a href="#" onclick="navigateTo('https://www.stackoverflow.com')">Stack Overflow</a></li>
                            <li><a href="#" onclick="navigateTo('https://www.reddit.com')">Reddit</a></li>
                            <li><a href="#" onclick="navigateTo('https://www.twitter.com')">Twitter</a></li>
                            <li><a href="#" onclick="navigateTo('https://www.facebook.com')">Facebook</a></li>
                            <li><a href="#" onclick="navigateTo('https://www.instagram.com')">Instagram</a></li>
                            <li><a href="#" onclick="navigateTo('https://www.microsoft.com')">Microsoft</a></li>
                        </ul>
                        
                        <p><strong>Введите любой URL в адресную строку выше! Сайты загружаются в полноэкранном режиме.</strong></p>
                    </div>
                </div>
            </div>
            <div class="window-statusbar">
                <div class="status-panel" id="browserStatus">Готов</div>
                <div class="status-panel">Зона: Интернет</div>
                <div class="status-panel">SSL: Безопасно</div>
            </div>
        </div>

        <!-- Окно магазина приложений - МАКСИМАЛЬНО ПРОРАБОТАНО -->
        <div class="window app-store" id="appstoreWindow">
            <div class="window-titlebar">
                <div class="window-icon">🏪</div>
                <div class="window-title">Магазин приложений Windows 98</div>
                <div class="window-controls">
                    <div class="window-control" data-action="minimize">_</div>
                    <div class="window-control" data-action="maximize">□</div>
                    <div class="window-control" data-action="close">×</div>
                </div>
            </div>
            <div class="window-menubar">
                <div class="menu-item">Файл</div>
                <div class="menu-item">Правка</div>
                <div class="menu-item">Вид</div>
                <div class="menu-item">Справка</div>
            </div>
            <div class="store-toolbar">
                <input type="text" class="store-search" placeholder="Поиск приложений..." onkeyup="searchApps(this.value)">
                <div class="toolbar-button" onclick="refreshStore()" title="Обновить">🔄</div>
            </div>
            <div class="store-content">
                <div class="store-categories">
                    <div class="store-category active" data-category="all" onclick="filterApps('all')">Все приложения</div>
                    <div class="store-category" data-category="games" onclick="filterApps('games')">Игры</div>
                    <div class="store-category" data-category="productivity" onclick="filterApps('productivity')">Продуктивность</div>
                    <div class="store-category" data-category="multimedia" onclick="filterApps('multimedia')">Мультимедиа</div>
                    <div class="store-category" data-category="internet" onclick="filterApps('internet')">Интернет</div>
                    <div class="store-category" data-category="utilities" onclick="filterApps('utilities')">Утилиты</div>
                    <div class="store-category" data-category="development" onclick="filterApps('development')">Разработка</div>
                </div>
                <div class="store-apps" id="storeApps">
                    <!-- Приложения будут загружены через JavaScript -->
                </div>
            </div>
        </div>

        <!-- Окно калькулятора -->
        <div class="window calculator" id="calculatorWindow">
            <div class="window-titlebar">
                <div class="window-icon">🔢</div>
                <div class="window-title">Калькулятор</div>
                <div class="window-controls">
                    <div class="window-control" data-action="minimize">_</div>
                    <div class="window-control" data-action="close">×</div>
                </div>
            </div>
            <div class="window-menubar">
                <div class="menu-item">Вид</div>
                <div class="menu-item">Правка</div>
                <div class="menu-item">Справка</div>
            </div>
            <div class="window-content" style="padding: 0;">
                <div class="calc-display" id="calcDisplay">0</div>
                <div class="calc-buttons">
                    <div class="calc-button" onclick="calcAction('clear')">C</div>
                    <div class="calc-button" onclick="calcAction('ce')">CE</div>
                    <div class="calc-button" onclick="calcAction('backspace')">←</div>
                    <div class="calc-button operator" onclick="calcAction('/')" >÷</div>
                    
                    <div class="calc-button" onclick="calcAction('7')">7</div>
                    <div class="calc-button" onclick="calcAction('8')">8</div>
                    <div class="calc-button" onclick="calcAction('9')">9</div>
                    <div class="calc-button operator" onclick="calcAction('*')">×</div>
                    
                    <div class="calc-button" onclick="calcAction('4')">4</div>
                    <div class="calc-button" onclick="calcAction('5')">5</div>
                    <div class="calc-button" onclick="calcAction('6')">6</div>
                    <div class="calc-button operator" onclick="calcAction('-')">-</div>
                    
                    <div class="calc-button" onclick="calcAction('1')">1</div>
                    <div class="calc-button" onclick="calcAction('2')">2</div>
                    <div class="calc-button" onclick="calcAction('3')">3</div>
                    <div class="calc-button operator" onclick="calcAction('+')">+</div>
                    
                    <div class="calc-button" onclick="calcAction('0')" style="grid-column: span 2;">0</div>
                    <div class="calc-button" onclick="calcAction('.')">.</div>
                    <div class="calc-button equals" onclick="calcAction('=')">=</div>
                </div>
            </div>
        </div>

        <!-- Панель задач -->
        <div class="taskbar">
            <div class="start-button" onclick="toggleStartMenu()">
                Пуск
            </div>
            <div class="quick-launch">
                <div class="quick-launch-icon" onclick="openApp('browser')" title="Internet Explorer">🌐</div>
                <div class="quick-launch-icon" onclick="openApp('filemanager')" title="Мой компьютер">📁</div>
                <div class="quick-launch-icon" onclick="openApp('notepad')" title="Блокнот">📝</div>
                <div class="quick-launch-icon" onclick="showDesktop()" title="Показать рабочий стол">🖥️</div>
            </div>
            <div class="task-list" id="taskList">
                <!-- Задачи будут добавляться динамически -->
            </div>
            <div class="system-tray">
                <div class="tray-icon" onclick="showVolumeControl()">🔊</div>
                <div class="tray-icon" onclick="showNetworkStatus()">📶</div>
                <div class="tray-icon" onclick="showAntivirus()">🛡️</div>
                <div class="clock" id="clock">00:00</div>
            </div>
        </div>

        <!-- Меню Пуск -->
        <div class="start-menu" id="startMenu">
            <div class="start-menu-header">
                Windows 98
            </div>
            <div class="start-menu-items">
                <div class="start-menu-item" onclick="openApp('browser')">
                    <div class="start-menu-icon">🌐</div>
                    <span>Internet Explorer</span>
                </div>
                <div class="start-menu-item" onclick="openApp('filemanager')">
                    <div class="start-menu-icon">📁</div>
                    <span>Мой компьютер</span>
                </div>
                <div class="start-menu-separator"></div>
                <div class="start-menu-item" onclick="openApp('notepad')">
                    <div class="start-menu-icon">📝</div>
                    <span>Блокнот</span>
                </div>
                <div class="start-menu-item" onclick="openApp('calculator')">
                    <div class="start-menu-icon">🔢</div>
                    <span>Калькулятор</span>
                </div>
                <div class="start-menu-item" onclick="openApp('paint')">
                    <div class="start-menu-icon">🎨</div>
                    <span>Paint</span>
                </div>
                <div class="start-menu-item" onclick="openApp('appstore')">
                    <div class="start-menu-icon">🏪</div>
                    <span>Магазин приложений</span>
                </div>
                <div class="start-menu-separator"></div>
                <div class="start-menu-item" onclick="openApp('minesweeper')">
                    <div class="start-menu-icon">💣</div>
                    <span>Сапер</span>
                </div>
                <div class="start-menu-item" onclick="openApp('solitaire')">
                    <div class="start-menu-icon">🃏</div>
                    <span>Пасьянс</span>
                </div>
                <div class="start-menu-separator"></div>
                <div class="start-menu-item" onclick="showRunDialog()">
                    <div class="start-menu-icon">▶️</div>
                    <span>Выполнить...</span>
                </div>
                <div class="start-menu-item" onclick="showShutdown()">
                    <div class="start-menu-icon">⚡</div>
                    <span>Завершение работы...</span>
                </div>
            </div>
        </div>

        <!-- Уведомления -->
        <div class="notification" id="notification">
            <div id="notificationText">Уведомление</div>
        </div>
    </div>

    <script>
        // Глобальные переменные
        let openWindows = new Set();
        let activeWindow = null;
        let zIndexCounter = 100;
        let isLoggedIn = false;
        let calcExpression = '';
        let calcDisplay = '0';
        let installedApps = new Set();

        // МАКСИМАЛЬНО ПРОРАБОТАННАЯ БАЗА ДАННЫХ ПРИЛОЖЕНИЙ
        const appDatabase = [
            // ИГРЫ
            {
                id: 'doom',
                name: 'DOOM',
                developer: 'id Software',
                description: 'Легендарный шутер от первого лица с адскими демонами',
                icon: '👹',
                category: 'games',
                rating: 4.9,
                size: '15.2 MB',
                features: ['Одиночная игра', 'Сетевая игра', '3D графика', 'Звуковые эффекты'],
                gameplay: {
                    enemies: ['Imp', 'Demon', 'Cacodemon', 'Cyberdemon'],
                    weapons: ['Pistol', 'Shotgun', 'Chaingun', 'Rocket Launcher', 'BFG'],
                    levels: 27,
                    difficulty: ['I am too young to die', 'Hey, not too rough', 'Hurt me plenty', 'Ultra-Violence', 'Nightmare']
                }
            },
            {
                id: 'quake',
                name: 'Quake',
                developer: 'id Software',
                description: 'Революционный 3D шутер с полигональной графикой',
                icon: '🌪️',
                category: 'games',
                rating: 4.8,
                size: '76.3 MB',
                features: ['Полная 3D графика', 'Мультиплеер', 'Моддинг', 'Физика'],
                gameplay: {
                    enemies: ['Grunt', 'Enforcer', 'Ogre', 'Shambler'],
                    weapons: ['Axe', 'Shotgun', 'Super Shotgun', 'Nailgun', 'Lightning Gun'],
                    episodes: 4,
                    boss: 'Shub-Niggurath'
                }
            },
            {
                id: 'solitaire',
                name: 'Microsoft Solitaire',
                developer: 'Microsoft',
                description: 'Классическая карточная игра пасьянс',
                icon: '🃏',
                category: 'games',
                rating: 4.3,
                size: '0.8 MB',
                features: ['Клондайк', 'Статистика', 'Рекорды', 'Разные колоды'],
                gameplay: {
                    modes: ['Клондайк', 'Freecell', 'Spider'],
                    scoring: 'Vegas/Standard',
                    cards: 52,
                    difficulty: 'Easy/Hard'
                }
            },
            {
                id: 'age_of_empires',
                name: 'Age of Empires',
                developer: 'Ensemble Studios',
                description: 'Эпическая стратегия в реальном времени',
                icon: '🏰',
                category: 'games',
                rating: 4.7,
                size: '120 MB',
                features: ['12 цивилизаций', 'Кампания', 'Мультиплеер', 'Редактор карт'],
                gameplay: {
                    civilizations: ['Египет', 'Вавилон', 'Греция', 'Рим'],
                    ages: ['Каменный век', 'Бронзовый век', 'Железный век'],
                    units: ['Воины', 'Лучники', 'Кавалерия', 'Осадные орудия'],
                    resources: ['Пища', 'Дерево', 'Золото', 'Камень']
                }
            },
            {
                id: 'civilization2',
                name: 'Civilization II',
                developer: 'MicroProse',
                description: 'Построй величайшую цивилизацию в истории',
                icon: '🏛️',
                category: 'games',
                rating: 4.9,
                size: '45.7 MB',
                features: ['21 цивилизация', 'Дипломатия', 'Торговля', 'Наука'],
                gameplay: {
                    victory: ['Завоевание', 'Космический корабль', 'Дипломатия'],
                    techs: 89,
                    units: 62,
                    wonders: 28
                }
            },

            // МУЛЬТИМЕДИА
            {
                id: 'winamp',
                name: 'Winamp',
                developer: 'Nullsoft',
                description: 'Самый популярный MP3 плеер с визуализацией',
                icon: '🎵',
                category: 'multimedia',
                rating: 4.8,
                size: '2.1 MB',
                features: ['MP3/WAV', 'Плейлисты', 'Эквалайзер', 'Скины', 'Визуализация'],
                audio: {
                    formats: ['MP3', 'WAV', 'CD Audio', 'MIDI'],
                    equalizer: '10-band',
                    visualizations: ['Oscilloscope', 'Spectrum', 'Milkdrop'],
                    plugins: 'Поддержка плагинов'
                }
            },
            {
                id: 'realplayer',
                name: 'RealPlayer',
                developer: 'RealNetworks',
                description: 'Потоковое видео и аудио воспроизведение',
                icon: '📹',
                category: 'multimedia',
                rating: 4.2,
                size: '8.7 MB',
                features: ['Потоковое видео', 'Радио', 'Закладки', 'Запись'],
                streaming: {
                    formats: ['RealAudio', 'RealVideo', 'MP3', 'AVI'],
                    bitrates: ['28.8K', '56K', '128K', '256K'],
                    radio: '1000+ станций',
                    record: 'Запись потоков'
                }
            },
            {
                id: 'mediaplayer',
                name: 'Windows Media Player',
                developer: 'Microsoft',
                description: 'Встроенный медиаплеер Windows',
                icon: '🎬',
                category: 'multimedia',
                rating: 4.1,
                size: '12.3 MB',
                features: ['Видео', 'Аудио', 'CD', 'DVD', 'Интернет-радио'],
                playback: {
                    video: ['AVI', 'MPEG', 'WMV', 'ASF'],
                    audio: ['WAV', 'MP3', 'WMA', 'MIDI'],
                    cd: 'CD Audio',
                    visualizations: 'Встроенные визуализации'
                }
            },

            // ПРОДУКТИВНОСТЬ
            {
                id: 'office97',
                name: 'Microsoft Office 97',
                developer: 'Microsoft',
                description: 'Полный офисный пакет для работы',
                icon: '📄',
                category: 'productivity',
                rating: 4.5,
                size: '125 MB',
                features: ['Word', 'Excel', 'PowerPoint', 'Access', 'Outlook'],
                applications: {
                    word: 'Текстовый редактор',
                    excel: 'Электронные таблицы',
                    powerpoint: 'Презентации',
                    access: 'База данных',
                    outlook: 'Почта и календарь'
                }
            },
            {
                id: 'photoshop',
                name: 'Adobe Photoshop 5.5',
                developer: 'Adobe Systems',
                description: 'Профессиональный графический редактор',
                icon: '🖼️',
                category: 'productivity',
                rating: 4.7,
                size: '45.8 MB',
                features: ['Слои', 'Фильтры', 'Маски', 'Векторные инструменты'],
                tools: {
                    selection: ['Лассо', 'Волшебная палочка', 'Перо'],
                    paint: ['Кисть', 'Карандаш', 'Аэрограф', 'Штамп'],
                    filters: ['Размытие', 'Резкость', 'Искажение', 'Художественные'],
                    formats: ['PSD', 'JPEG', 'PNG', 'GIF', 'TIFF']
                }
            },
            {
                id: 'acrobat',
                name: 'Adobe Acrobat Reader',
                developer: 'Adobe Systems',
                description: 'Просмотр PDF документов',
                icon: '📕',
                category: 'productivity',
                rating: 4.3,
                size: '8.2 MB',
                features: ['PDF просмотр', 'Печать', 'Поиск', 'Закладки'],
                pdf: {
                    zoom: '25% - 800%',
                    navigation: 'Закладки и миниатюры',
                    search: 'Поиск по тексту',
                    print: 'Высококачественная печать'
                }
            },

            // ИНТЕРНЕТ
            {
                id: 'icq',
                name: 'ICQ',
                developer: 'Mirabilis',
                description: 'Мгновенные сообщения и чат',
                icon: '💬',
                category: 'internet',
                rating: 4.6,
                size: '3.2 MB',
                features: ['Мгновенные сообщения', 'Файлообмен', 'Чат-комнаты'],
                communication: {
                    messages: 'Мгновенные сообщения',
                    files: 'Передача файлов',
                    status: 'Статусы пользователей',
                    history: 'История сообщений'
                }
            },
            {
                id: 'netscape',
                name: 'Netscape Navigator',
                developer: 'Netscape',
                description: 'Альтернативный веб-браузер',
                icon: '🌐',
                category: 'internet',
                rating: 4.4,
                size: '14.7 MB',
                features: ['HTML', 'JavaScript', 'Java', 'Плагины'],
                web: {
                    html: 'HTML 4.0',
                    javascript: 'JavaScript 1.3',
                    java: 'Java Applets',
                    plugins: 'Netscape Plugins'
                }
            },
            {
                id: 'outlook',
                name: 'Microsoft Outlook Express',
                developer: 'Microsoft',
                description: 'Почтовый клиент и новости',
                icon: '📧',
                category: 'internet',
                rating: 4.2,
                size: '6.8 MB',
                features: ['Email', 'Новости', 'Адресная книга', 'Папки'],
                email: {
                    accounts: 'Множественные аккаунты',
                    folders: 'Папки и фильтры',
                    attachments: 'Вложения файлов',
                    security: 'Цифровые подписи'
                }
            },

            // УТИЛИТЫ
            {
                id: 'winzip',
                name: 'WinZip',
                developer: 'WinZip Computing',
                description: 'Архиватор файлов с поддержкой ZIP',
                icon: '📦',
                category: 'utilities',
                rating: 4.4,
                size: '1.8 MB',
                features: ['ZIP архивы', 'Самораспаковывающиеся архивы', 'Шифрование'],
                compression: {
                    formats: ['ZIP', 'LZH', 'TAR', 'GZ'],
                    encryption: 'AES шифрование',
                    ratio: 'Высокая степень сжатия',
                    wizard: 'Мастер архивирования'
                }
            },
            {
                id: 'norton',
                name: 'Norton AntiVirus',
                developer: 'Symantec',
                description: 'Антивирусная защита в реальном времени',
                icon: '🛡️',
                category: 'utilities',
                rating: 4.5,
                size: '18.4 MB',
                features: ['Сканирование', 'Карантин', 'Автообновление', 'Фаервол'],
                security: {
                    realtime: 'Защита в реальном времени',
                    scan: 'Полное и быстрое сканирование',
                    quarantine: 'Карантин вирусов',
                    updates: 'Автоматические обновления'
                }
            },
            {
                id: 'regclean',
                name: 'Registry Cleaner',
                developer: 'Microsoft',
                description: 'Очистка и оптимизация реестра Windows',
                icon: '🧹',
                category: 'utilities',
                rating: 4.1,
                size: '2.3 MB',
                features: ['Очистка реестра', 'Резервное копирование', 'Оптимизация'],
                registry: {
                    scan: 'Сканирование ошибок',
                    backup: 'Создание резервных копий',
                    repair: 'Исправление ошибок',
                    optimize: 'Оптимизация скорости'
                }
            },

            // РАЗРАБОТКА
            {
                id: 'visualstudio',
                name: 'Microsoft Visual Studio 6.0',
                developer: 'Microsoft',
                description: 'Интегрированная среда разработки',
                icon: '💻',
                category: 'development',
                rating: 4.6,
                size: '180 MB',
                features: ['Visual C++', 'Visual Basic', 'Отладчик', 'IntelliSense'],
                development: {
                    languages: ['C++', 'Visual Basic', 'J++', 'FoxPro'],
                    debugger: 'Мощный отладчик',
                    intellisense: 'Автодополнение кода',
                    compiler: 'Оптимизирующий компилятор'
                }
            },
            {
                id: 'frontpage',
                name: 'Microsoft FrontPage',
                developer: 'Microsoft',
                description: 'Веб-редактор WYSIWYG',
                icon: '🌍',
                category: 'development',
                rating: 4.2,
                size: '65.4 MB',
                features: ['WYSIWYG', 'HTML редактор', 'Шаблоны', 'FTP'],
                web_dev: {
                    wysiwyg: 'Визуальный редактор',
                    html: 'HTML/CSS редактор',
                    templates: 'Готовые шаблоны',
                    publish: 'Публикация на сервер'
                }
            }
        ];

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            updateClock();
            setInterval(updateClock, 1000);
            
            // Последовательность загрузки
            setTimeout(() => {
                document.getElementById('biosScreen').style.display = 'none';
            }, 4000);
            
            setTimeout(() => {
                document.getElementById('bootScreen').style.display = 'none';
            }, 10000);
            
            setTimeout(() => {
                if (!isLoggedIn) {
                    document.getElementById('loginScreen').classList.remove('hidden');
                }
            }, 10500);
            
            // Обработка Enter в поле пароля
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // Загрузка приложений в магазин
            loadStoreApps();
            
            // Создание системных окон
            createSystemWindows();
        });

        // Система входа
        function login() {
            const password = document.getElementById('passwordInput').value;
            const errorElement = document.getElementById('loginError');
            
            if (password === 'Andrey2914') {
                isLoggedIn = true;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('desktop').classList.add('show');
                showNotification('Добро пожаловать в Windows 98!');
                
                // Автоматическое открытие браузера
                setTimeout(() => {
                    openApp('browser');
                }, 1000);
            } else {
                errorElement.textContent = 'Неверный пароль. Попробуйте еще раз.';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function cancelLogin() {
            document.getElementById('passwordInput').value = '';
            document.getElementById('loginError').textContent = '';
        }

        // Часы
        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('clock').textContent = time;
        }

        // ИСПРАВЛЕНО: Открытие приложений
        function openApp(appName) {
            let windowElement = document.getElementById(appName + 'Window');
            
            // Если окно не найдено, создаем его для установленных приложений
            if (!windowElement && installedApps.has(appName)) {
                createAppWindow(appName);
                windowElement = document.getElementById(appName + 'Window');
            }
            
            if (!windowElement) {
                showNotification(`Приложение "${appName}" не найдено`);
                return;
            }
            
            if (openWindows.has(appName)) {
                windowElement.style.display = 'block';
                activateWindow(windowElement);
                return;
            }
            
            const offset = openWindows.size * 30;
            windowElement.style.display = 'block';
            windowElement.style.left = (100 + offset) + 'px';
            windowElement.style.top = (100 + offset) + 'px';
            windowElement.classList.add('opening');
            
            openWindows.add(appName);
            activateWindow(windowElement);
            updateTaskbar();
            
            document.getElementById('startMenu').classList.remove('show');
            
            setTimeout(() => {
                windowElement.classList.remove('opening');
            }, 200);
        }

        // ПОЛНОСТЬЮ ФУНКЦИОНАЛЬНЫЕ ДИНАМИЧЕСКИ СОЗДАВАЕМЫЕ ОКНА
        function createAppWindow(appId) {
            const app = appDatabase.find(a => a.id === appId);
            if (!app) return;
            
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = appId + 'Window';
            windowElement.style.width = '600px';
            windowElement.style.height = '450px';
            
            let windowContent = '';
            
            switch(app.category) {
                case 'games':
                    windowContent = createGameWindow(app);
                    break;
                case 'multimedia':
                    windowContent = createMultimediaWindow(app);
                    break;
                case 'productivity':
                    windowContent = createProductivityWindow(app);
                    break;
                case 'internet':
                    windowContent = createInternetWindow(app);
                    break;
                case 'utilities':
                    windowContent = createUtilityWindow(app);
                    break;
                case 'development':
                    windowContent = createDevelopmentWindow(app);
                    break;
                default:
                    windowContent = createDefaultWindow(app);
            }
            
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">${app.icon}</div>
                    <div class="window-title">${app.name}</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Правка</div>
                    <div class="menu-item">Вид</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content">
                    ${windowContent}
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">Готов</div>
                    <div class="status-panel">${app.developer}</div>
                </div>
            `;
            
            document.getElementById('desktop').appendChild(windowElement);
        }

        function createGameWindow(app) {
            if (app.id === 'doom') {
                return `
                    <div style="display: flex; height: 100%;">
                        <div style="width: 200px; background: #000; color: #ff0000; padding: 10px; font-family: monospace;">
                            <h3>🔥 DOOM ENGINE</h3>
                            <div style="margin: 10px 0;">
                                <div>HP: <span style="color: #00ff00;">100</span></div>
                                <div>ARMOR: <span style="color: #0080ff;">50</span></div>
                                <div>AMMO: <span style="color: #ffff00;">200</span></div>
                            </div>
                            <div style="margin: 10px 0;">
                                <h4>WEAPONS:</h4>
                                <div>🔫 Pistol</div>
                                <div>💥 Shotgun</div>
                                <div>🎯 Chaingun</div>
                                <div>🚀 Rocket Launcher</div>
                            </div>
                            <div style="margin: 10px 0;">
                                <h4>ENEMIES:</h4>
                                <div>👹 Imp x3</div>
                                <div>😈 Demon x2</div>
                                <div>👁️ Cacodemon x1</div>
                            </div>
                        </div>
                        <div style="flex: 1; background: #333; position: relative;">
                            <canvas class="game-canvas" width="350" height="280" style="background: linear-gradient(180deg, #654321 0%, #8b4513 50%, #2f4f2f 100%);"></canvas>
                                                        <div class="game-controls">
                                <div class="app-button" onclick="startDoomGame('${app.id}')">🎮 ИГРАТЬ</div>
                                <div class="app-button" onclick="doomSettings('${app.id}')">⚙️ Настройки</div>
                                <div class="app-button" onclick="doomSave('${app.id}')">💾 Сохранить</div>
                                <div class="app-button" onclick="doomLoad('${app.id}')">📂 Загрузить</div>
                            </div>
                            <div style="position: absolute; bottom: 10px; left: 10px; color: #ff0000; font-family: monospace;">
                                <div>LEVEL: E1M1 - Hangar</div>
                                <div>DIFFICULTY: Ultra-Violence</div>
                                <div>KILLS: 15/23</div>
                                <div>SECRETS: 2/4</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (app.id === 'quake') {
                return `
                    <div style="text-align: center; padding: 20px;">
                        <div style="background: #000; height: 250px; position: relative; border: 2px solid #666;">
                            <canvas class="game-canvas" width="400" height="240" style="background: linear-gradient(45deg, #8B4513 0%, #654321 50%, #2F4F2F 100%);"></canvas>
                            <div style="position: absolute; top: 10px; left: 10px; color: #00ff00; font-family: monospace; font-size: 12px;">
                                <div>QUAKE v1.06</div>
                                <div>FPS: 60</div>
                                <div>PING: 25ms</div>
                            </div>
                        </div>
                        <div class="game-controls">
                            <div class="app-button" onclick="quakeStart('${app.id}')">🚀 Начать игру</div>
                            <div class="app-button" onclick="quakeMultiplayer('${app.id}')">🌐 Мультиплеер</div>
                            <div class="app-button" onclick="quakeOptions('${app.id}')">⚙️ Опции</div>
                        </div>
                        <div style="margin-top: 10px; font-size: 11px;">
                            <strong>Эпизоды:</strong> Dimension of the Doomed | The Realm of Black Magic | The Netherworld | The Elder World
                        </div>
                    </div>
                `;
            } else if (app.id === 'solitaire') {
                return `
                    <div style="background: #008000; padding: 15px; height: 100%;">
                        <div class="game-controls">
                            <div class="app-button" onclick="solitaireNew('${app.id}')">🃏 Новая игра</div>
                            <div class="app-button" onclick="solitaireUndo('${app.id}')">↶ Отменить</div>
                            <div class="app-button" onclick="solitaireHint('${app.id}')">💡 Подсказка</div>
                            <div class="app-button" onclick="solitaireStats('${app.id}')">📊 Статистика</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 20px 0;">
                            <div class="card" style="width: 60px; height: 80px; background: #000080; border: 1px solid white; border-radius: 4px; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="drawCard()">🂠</div>
                            <div class="card" style="width: 60px; height: 80px; background: white; border: 1px solid #000; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer;">🃁</div>
                            <div class="card" style="width: 60px; height: 80px; background: white; border: 1px solid #000; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer;">🂱</div>
                            <div class="card" style="width: 60px; height: 80px; background: white; border: 1px solid #000; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer;">🃑</div>
                        </div>
                        <div style="display: flex; justify-content: space-around; margin-top: 20px;">
                            ${Array(7).fill().map((_, i) => `<div class="card-stack" style="width: 60px; height: 80px; background: ${i % 2 ? '#000080' : 'white'}; border: 1px solid ${i % 2 ? 'white' : '#000'}; border-radius: 4px; cursor: pointer;" onclick="moveCard(${i})"></div>`).join('')}
                        </div>
                        <div class="game-score" style="color: white;">Очки: <span id="solitaire-score">0</span> | Время: <span id="solitaire-time">00:00</span></div>
                    </div>
                `;
            } else {
                return `
                    <div style="text-align: center; padding: 50px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">${app.icon}</div>
                        <h2>${app.name}</h2>
                        <p>${app.description}</p>
                        <div style="margin: 20px 0;">
                            <strong>Особенности:</strong> ${app.features.join(', ')}
                        </div>
                        <div class="game-controls">
                            <div class="app-button" onclick="startGame('${app.id}')">🎮 ИГРАТЬ</div>
                            <div class="app-button" onclick="gameSettings('${app.id}')">⚙️ Настройки</div>
                            <div class="app-button" onclick="gameHelp('${app.id}')">❓ Справка</div>
                        </div>
                    </div>
                `;
            }
        }

        function createMultimediaWindow(app) {
            if (app.id === 'winamp') {
                return `
                    <div style="background: linear-gradient(45deg, #FF6600, #FF9900); color: white; height: 100%; padding: 10px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h2>🎵 ${app.name} v2.95</h2>
                            <div style="font-size: 12px;">"It really whips the llama's ass!"</div>
                        </div>
                        
                        <div class="media-display" style="height: 60px; background: #000; color: #00ff00; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                            ♪♪♪ Prodigy - Firestarter.mp3 ♪♪♪
                        </div>
                        
                        <div style="margin: 10px 0; display: flex; align-items: center; gap: 5px;">
                            <span style="font-size: 10px;">00:00</span>
                            <div style="flex: 1; height: 12px; background: #333; border: 1px inset #666; position: relative;">
                                <div style="width: 35%; height: 100%; background: linear-gradient(to right, #0080ff, #00ff80);"></div>
                            </div>
                            <span style="font-size: 10px;">03:42</span>
                        </div>
                        
                        <div class="media-controls">
                            <div class="media-button" onclick="winampPrev('${app.id}')" title="Предыдущий">⏮️</div>
                            <div class="media-button" onclick="winampPlay('${app.id}')" title="Воспроизвести">▶️</div>
                            <div class="media-button" onclick="winampPause('${app.id}')" title="Пауза">⏸️</div>
                            <div class="media-button" onclick="winampStop('${app.id}')" title="Стоп">⏹️</div>
                            <div class="media-button" onclick="winampNext('${app.id}')" title="Следующий">⏭️</div>
                            <div class="media-button" onclick="winampEqualizer('${app.id}')" title="Эквалайзер">🎚️</div>
                            <div class="media-button" onclick="winampPlaylist('${app.id}')" title="Плейлист">📋</div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <h3>🎚️ Эквалайзер</h3>
                            <div style="display: flex; gap: 3px; justify-content: center; margin: 10px 0;">
                                ${Array(10).fill().map((_, i) => `
                                    <div style="display: flex; flex-direction: column; align-items: center;">
                                        <div style="width: 15px; height: 60px; background: #333; border: 1px inset #666; position: relative;">
                                            <div style="width: 100%; height: ${Math.random() * 60}%; background: #00ff00; position: absolute; bottom: 0;"></div>
                                        </div>
                                        <div style="font-size: 8px; margin-top: 2px;">${['60', '170', '310', '600', '1K', '3K', '6K', '12K', '14K', '16K'][i]}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px;">
                            <h4>📋 Плейлист</h4>
                            <div style="background: #000; color: #00ff00; height: 80px; overflow-y: auto; padding: 5px; font-family: monospace; font-size: 10px;">
                                <div>1. Prodigy - Firestarter.mp3 [03:42] ◄ Playing</div>
                                <div>2. Fatboy Slim - The Rockafeller Skank.mp3 [06:55]</div>
                                <div>3. The Chemical Brothers - Block Rockin' Beats.mp3 [04:59]</div>
                                <div>4. Daft Punk - Around The World.mp3 [07:09]</div>
                                <div>5. Underworld - Born Slippy.mp3 [09:43]</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (app.id === 'realplayer') {
                return `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h2>📹 ${app.name}</h2>
                            <div style="font-size: 11px;">Потоковое мультимедиа</div>
                        </div>
                        
                        <div class="media-display" style="height: 200px; background: #000; border: 2px inset #666; display: flex; align-items: center; justify-content: center; color: #ffffff;">
                            <div style="text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 10px;">📺</div>
                                <div>RealVideo Stream</div>
                                <div style="font-size: 10px; color: #ccc;">320x240 @ 28.8K</div>
                            </div>
                        </div>
                        
                        <div class="media-controls" style="margin: 15px 0;">
                            <div class="media-button" onclick="realPlay('${app.id}')">▶️</div>
                            <div class="media-button" onclick="realPause('${app.id}')">⏸️</div>
                            <div class="media-button" onclick="realStop('${app.id}')">⏹️</div>
                            <div class="media-button" onclick="realForward('${app.id}')">⏩</div>
                            <div class="media-button" onclick="realBack('${app.id}')">⏪</div>
                            <div class="media-button" onclick="realVolume('${app.id}')">🔊</div>
                            <div class="media-button" onclick="realFullscreen('${app.id}')">⛶</div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>🌐 Интернет-радио:</strong>
                            <div style="margin: 5px 0;">
                                <select style="width: 100%; padding: 2px;">
                                    <option>BBC World Service</option>
                                    <option>CNN Headline News</option>
                                    <option>MTV Live</option>
                                    <option>Radio Europa</option>
                                    <option>Jazz FM</option>
                                </select>
                            </div>
                            <div class="app-button" onclick="realTuneIn('${app.id}')">📻 Слушать</div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <strong>🔗 Закладки:</strong>
                            <div style="font-size: 10px; margin: 5px 0;">
                                <div>📺 CNN Live Stream</div>
                                <div>🎵 MTV Music Videos</div>
                                <div>📰 BBC News</div>
                                <div>🎬 Movie Trailers</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return createDefaultWindow(app);
            }
        }

        function createProductivityWindow(app) {
            if (app.id === 'office97') {
                return `
                    <div style="padding: 20px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h2>📄 Microsoft Office 97</h2>
                            <div style="font-size: 11px;">Профессиональное издание</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="text-align: center; padding: 15px; border: 1px solid #999; cursor: pointer;" onclick="openWord('${app.id}')">
                                <div style="font-size: 32px; margin-bottom: 5px;">📝</div>
                                <div><strong>Microsoft Word</strong></div>
                                <div style="font-size: 10px;">Текстовый процессор</div>
                            </div>
                            <div style="text-align: center; padding: 15px; border: 1px solid #999; cursor: pointer;" onclick="openExcel('${app.id}')">
                                <div style="font-size: 32px; margin-bottom: 5px;">📊</div>
                                <div><strong>Microsoft Excel</strong></div>
                                <div style="font-size: 10px;">Электронные таблицы</div>
                            </div>
                            <div style="text-align: center; padding: 15px; border: 1px solid #999; cursor: pointer;" onclick="openPowerPoint('${app.id}')">
                                <div style="font-size: 32px; margin-bottom: 5px;">📽️</div>
                                <div><strong>PowerPoint</strong></div>
                                <div style="font-size: 10px;">Презентации</div>
                            </div>
                            <div style="text-align: center; padding: 15px; border: 1px solid #999; cursor: pointer;" onclick="openAccess('${app.id}')">
                                <div style="font-size: 32px; margin-bottom: 5px;">🗃️</div>
                                <div><strong>Microsoft Access</strong></div>
                                <div style="font-size: 10px;">База данных</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h3>📈 Последние документы:</h3>
                            <div style="font-size: 10px; margin: 5px 0;">
                                <div style="margin: 3px 0; cursor: pointer;">📄 Отчет Q4 1998.doc</div>
                                <div style="margin: 3px 0; cursor: pointer;">📊 Бюджет компании.xls</div>
                                <div style="margin: 3px 0; cursor: pointer;">📽️ Презентация проекта.ppt</div>
                                <div style="margin: 3px 0; cursor: pointer;">🗃️ Клиентская база.mdb</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <div class="app-button" onclick="officeAssistant('${app.id}')">🧙 Office Assistant</div>
                            <div class="app-button" onclick="officeUpdates('${app.id}')">🔄 Обновления</div>
                        </div>
                    </div>
                `;
            } else if (app.id === 'photoshop') {
                return `
                    <div style="display: flex; height: 100%;">
                        <div style="width: 60px; background: #333; padding: 5px;">
                            <div style="color: white; text-align: center; margin-bottom: 10px; font-size: 10px;">Инструменты</div>
                            ${['🏹', '🖌️', '✏️', '🪣', '🔍', '✂️', '📏', '🎨'].map(tool => 
                                `<div style="width: 48px; height: 48px; background: #666; margin: 2px 0; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px;" onclick="selectTool('${tool}')">${tool}</div>`
                            ).join('')}
                        </div>
                        
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <div style="height: 30px; background: #ccc; display: flex; align-items: center; padding: 0 10px; font-size: 10px;">
                                Файл | Правка | Изображение | Слой | Выделение | Фильтр | Вид | Окно | Справка
                            </div>
                            
                            <div style="flex: 1; background: #999; position: relative; overflow: hidden;">
                                <canvas width="300" height="200" style="background: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 1px solid #000;"></canvas>
                                <div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px; font-size: 10px;">
                                    Размер: 300x200 px<br>
                                    Режим: RGB<br>
                                    Разрешение: 72 dpi
                                </div>
                            </div>
                        </div>
                        
                        <div style="width: 120px; background: #ddd; padding: 5px;">
                            <div style="margin-bottom: 10px;">
                                <div style="font-size: 10px; font-weight: bold; margin-bottom: 5px;">Слои</div>
                                <div style="background: white; border: 1px solid #999; padding: 2px; margin-bottom: 2px; font-size: 9px;">👁️ Фон</div>
                                <div style="background: #cce7ff; border: 1px solid #0066cc; padding: 2px; margin-bottom: 2px; font-size: 9px;">👁️ Слой 1</div>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <div style="font-size: 10px; font-weight: bold; margin-bottom: 5px;">История</div>
                                <div style="background: white; border: 1px solid #999; height: 60px; font-size: 8px; padding: 2px; overflow-y: auto;">
                                    <div>Создать документ</div>
                                    <div>Кисть</div>
                                    <div>Заливка</div>
                                </div>
                            </div>
                            
                            <div>
                                <div style="font-size: 10px; font-weight: bold; margin-bottom: 5px;">Цвета</div>
                                <div style="display: flex; gap: 5px;">
                                    <div style="width: 30px; height: 30px; background: #000; border: 1px solid #999;"></div>
                                    <div style="width: 30px; height: 30px; background: #fff; border: 1px solid #999;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return createDefaultWindow(app);
            }
        }

        function createInternetWindow(app) {
            if (app.id === 'icq') {
                return `
                    <div style="background: linear-gradient(45deg, #4CAF50, #2196F3); color: white; padding: 15px; height: 100%;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h2>💬 ICQ v99a</h2>
                            <div style="font-size: 11px;">Пользователь: Andrey2914 (онлайн)</div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.9); color: black; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">📋 Список контактов:</div>
                            <div style="margin: 5px 0; display: flex; align-items: center; gap: 5px; cursor: pointer;" onclick="icqChat('friend1')">
                                <span style="color: green;">●</span> Друг123 (В сети)
                            </div>
                            <div style="margin: 5px 0; display: flex; align-items: center; gap: 5px; cursor: pointer;" onclick="icqChat('colleague')">
                                <span style="color: orange;">●</span> Коллега_Иван (Отошел)
                            </div>
                            <div style="margin: 5px 0; display: flex; align-items: center; gap: 5px;">
                                <span style="color: red;">●</span> Мама (Не в сети)
                            </div>
                            <div style="margin: 5px 0; display: flex; align-items: center; gap: 5px; cursor: pointer;" onclick="icqChat('work')">
                                <span style="color: green;">●</span> Работа_Петр (В сети)
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.9); color: black; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">💬 Последние сообщения:</div>
                            <div style="font-size: 10px; margin: 3px 0;">
                                <strong>Друг123:</strong> Привет! Как дела?
                            </div>
                            <div style="font-size: 10px; margin: 3px 0;">
                                <strong>Работа_Петр:</strong> Отчет готов
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                            <input type="text" placeholder="Написать сообщение..." style="flex: 1; padding: 5px; border: none; border-radius: 3px;">
                            <div class="app-button" onclick="icqSend('${app.id}')">📤</div>
                        </div>
                        
                        <div style="display: flex; gap: 5px;">
                            <div class="app-button" onclick="icqAddContact('${app.id}')">👤 Добавить</div>
                            <div class="app-button" onclick="icqSearch('${app.id}')">🔍 Поиск</div>
                            <div class="app-button" onclick="icqSettings('${app.id}')">⚙️ Настройки</div>
                        </div>
                        
                        <div style="margin-top: 15px; font-size: 10px; text-align: center;">
                            Пользователей онлайн: 2,847,391<br>
                            Ваш UIN: 12345678
                        </div>
                    </div>
                `;
            } else {
                return createDefaultWindow(app);
            }
        }

        function createUtilityWindow(app) {
            if (app.id === 'winzip') {
                return `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h2>📦 ${app.name}</h2>
                            <div style="font-size: 11px;">Архиватор файлов</div>
                        </div>
                        
                        <div style="background: white; border: 1px inset #ccc; height: 200px; margin-bottom: 15px; padding: 5px;">
                            <div style="background: #f0f0f0; padding: 5px; border-bottom: 1px solid #ccc; font-weight: bold; font-size: 10px;">
                                Имя | Тип | Размер | Сжато | Дата
                            </div>
                            <div style="padding: 5px; font-size: 10px;">
                                <div style="margin: 2px 0; cursor: pointer;">📄 readme.txt | Текст | 2.1 KB | 1.8 KB | 15.07.98</div>
                                <div style="margin: 2px 0; cursor: pointer;">🖼️ image.bmp | Bitmap | 245 KB | 89 KB | 14.07.98</div>
                                <div style="margin: 2px 0; cursor: pointer;">💻 setup.exe | Программа | 1.2 MB | 654 KB | 13.07.98</div>
                                <div style="margin: 2px 0; cursor: pointer;">📁 docs/ | Папка | - | - | 12.07.98</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 5px; margin-bottom: 15px;">
                            <div class="app-button" onclick="winzipNew('${app.id}')">📦 Создать</div>
                            <div class="app-button" onclick="winzipOpen('${app.id}')">📂 Открыть</div>
                            <div class="app-button" onclick="winzipExtract('${app.id}')">📤 Извлечь</div>
                            <div class="app-button" onclick="winzipAdd('${app.id}')">➕ Добавить</div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>🔒 Настройки сжатия:</strong>
                            <div style="margin: 5px 0;">
                                <label><input type="radio" name="compression" checked> Максимальное сжатие</label><br>
                                <label><input type="radio" name="compression"> Обычное сжатие</label><br>
                                <label><input type="radio" name="compression"> Быстрое сжатие</label>
                            </div>
                            <label><input type="checkbox"> Использовать пароль</label>
                        </div>
                        
                        <div style="background: #f0f0f0; padding: 10px; border: 1px solid #ccc;">
                            <div style="font-size: 10px;">
                                <strong>Статистика:</strong><br>
                                Файлов: 4 | Папок: 1<br>
                                Исходный размер: 1.45 MB<br>
                                Сжатый размер: 742 KB<br>
                                Степень сжатия: 48.9%
                            </div>
                        </div>
                    </div>
                `;
            } else if (app.id === 'norton') {
                return `
                    <div style="background: linear-gradient(45deg, #FFD700, #FFA500); padding: 15px; height: 100%;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h2>🛡️ Norton AntiVirus</h2>
                            <div style="font-size: 11px;">Версия 4.0 - Защита в реальном времени</div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <div style="font-size: 32px;">✅</div>
                                <div>
                                    <div style="font-weight: bold; color: green;">Система защищена</div>
                                    <div style="font-size: 10px;">Автозащита активна</div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong>📊 Статистика защиты:</strong>
                                <div style="font-size: 10px; margin: 5px 0;">
                                    <div>Последняя проверка: Сегодня, 14:32</div>
                                    <div>Проверено файлов: 45,821</div>
                                    <div>Обнаружено угроз: 3 (помещены в карантин)</div>
                                    <div>База данных: Актуальна (16.07.98)</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 5px; margin-bottom: 15px;">
                            <div class="app-button" onclick="nortonScan('${app.id}')">🔍 Проверить</div>
                            <div class="app-button" onclick="nortonQuarantine('${app.id}')">🏥 Карантин</div>
                            <div class="app-button" onclick="nortonUpdate('${app.id}')">🔄 Обновить</div>
                            <div class="app-button" onclick="nortonSettings('${app.id}')">⚙️ Настройки</div>
                        </div>
                        
                        <div style="background: white; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">🦠 Обнаруженные угрозы:</div>
                            <div style="font-size: 10px;">
                                <div style="color: red;">⚠️ Trojan.Win32.Fake - Удален</div>
                                <div style="color: orange;">⚠️ Adware.Cookie - Карантин</div>
                                <div style="color: red;">⚠️ Virus.Boot.Sector - Вылечен</div>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 10px; border-radius: 5px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">📈 Производительность системы:</div>
                            <div style="font-size: 10px;">
                                <div>Загрузка CPU: 12%</div>
                                <div>Использование памяти: 8.2 MB</div>
                                <div>Скорость сканирования: 2,341 файлов/мин</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return createDefaultWindow(app);
            }
        }

        function createDevelopmentWindow(app) {
            if (app.id === 'visualstudio') {
                return `
                    <div style="display: flex; height: 100%; background: #f0f0f0;">
                        <div style="width: 200px; background: #e0e0e0; border-right: 1px solid #999; padding: 5px;">
                            <div style="font-weight: bold; margin-bottom: 10px; font-size: 10px;">Обозреватель проектов</div>
                            <div style="font-size: 10px;">
                                <div style="margin: 2px 0; cursor: pointer;">📁 MyProject</div>
                                <div style="margin: 2px 0; margin-left: 15px; cursor: pointer;">📄 main.cpp</div>
                                <div style="margin: 2px 0; margin-left: 15px; cursor: pointer;">📄 dialog.cpp</div>
                                <div style="margin: 2px 0; margin-left: 15px; cursor: pointer;">📄 resource.rc</div>
                                <div style="margin: 2px 0; margin-left: 15px; cursor: pointer;">📄 stdafx.h</div>
                            </div>
                        </div>
                        
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <div style="height: 25px; background: #d0d0d0; display: flex; align-items: center; padding: 0 5px; font-size: 10px; border-bottom: 1px solid #999;">
                                Файл | Правка | Вид | Проект | Построение | Отладка | Сервис | Окно | Справка
                            </div>
                            
                            <div style="height: 30px; background: #e8e8e8; display: flex; align-items: center; padding: 0 5px; border-bottom: 1px solid #999;">
                                <div class="toolbar-button" title="Создать">📄</div>
                                <div class="toolbar-button" title="Открыть">📂</div>
                                <div class="toolbar-button" title="Сохранить">💾</div>
                                <div style="margin: 0 10px;">|</div>
                                <div class="toolbar-button" title="Вырезать">✂️</div>
                                <div class="toolbar-button" title="Копировать">📋</div>
                                <div class="toolbar-button" title="Вставить">📋</div>
                                <div style="margin: 0 10px;">|</div>
                                <div class="toolbar-button" title="Построить">🔨</div>
                                <div class="toolbar-button" title="Отладка">🐛</div>
                                <div class="toolbar-button" title="Запуск">▶️</div>
                            </div>
                            
                            <div style="flex: 1; background: white; font-family: 'Courier New', monospace; font-size: 11px; padding: 10px; overflow: auto;">
                                <div style="color: blue;">#include</div>
                                <div style="color: blue;">#include</div>
                                <div><br></div>
                                <div><span style="color: blue;">int</span> <span style="color: purple;">main</span>() {</div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">// Главная функция программы</span></div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">printf</span>(<span style="color: red;">"Hello, World!\\n"</span>);</div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> <span style="color: red;">0</span>;</div>
                                <div>}</div>
                                <div style="background: yellow; display: inline;">|</div>
                            </div>
                        </div>
                        
                        <div style="width: 150px; background: #e0e0e0; border-left: 1px solid #999; padding: 5px;">
                            <div style="font-weight: bold; margin-bottom: 5px; font-size: 10px;">Свойства</div>
                            <div style="font-size: 9px; margin-bottom: 10px;">
                                <div>Тип: Win32 Application</div>
                                <div>Компилятор: Visual C++ 6.0</div>
                                <div>Отладка: Debug</div>
                            </div>
                            
                            <div style="font-weight: bold; margin-bottom: 5px; font-size: 10px;">Вывод</div>
                            <div style="background: white; height: 80px; overflow-y: auto; font-size: 9px; padding: 2px; border: 1px inset #ccc;">
                                Построение начато...<br>
                                Компиляция main.cpp<br>
                                Компоновка...<br>
                                MyProject.exe - 0 ошибок, 0 предупреждений
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return createDefaultWindow(app);
            }
        }

        function createDefaultWindow(app) {
            return `
                <div style="text-align: center; padding: 50px;">
                    <div style="font-size: 64px; margin-bottom: 20px;">${app.icon}</div>
                    <h2>${app.name}</h2>
                    <p>${app.description}</p>
                    <div style="margin: 20px 0;">
                        <strong>Разработчик:</strong> ${app.developer}<br>
                        <strong>Размер:</strong> ${app.size}<br>
                        <strong>Рейтинг:</strong> ⭐ ${app.rating}/5.0
                    </div>
                    <div style="margin: 20px 0;">
                        <strong>Особенности:</strong><br>
                        ${app.features.map(f => `• ${f}`).join('<br>')}
                    </div>
                    <div class="app-button" onclick="alert('${app.name} запущен!')">▶️ Запустить</div>
                </div>
            `;
        }

        // Создание системных окон
        function createSystemWindows() {
            // Блокнот
            const notepadWindow = document.createElement('div');
            notepadWindow.className = 'window';
            notepadWindow.id = 'notepadWindow';
            notepadWindow.style.width = '600px';
            notepadWindow.style.height = '450px';
            notepadWindow.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">📝</div>
                    <div class="window-title">Блокнот - Без названия</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Правка</div>
                    <div class="menu-item">Поиск</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content" style="padding: 0;">
                    <textarea class="selectable" style="width: 100%; height: 100%; border: none; padding: 8px; font-family: 'Courier New', monospace; font-size: 12px; resize: none; outline: none;" placeholder="Введите текст..."></textarea>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">Готов</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(notepadWindow);

            // Paint
            const paintWindow = document.createElement('div');
            paintWindow.className = 'window';
            paintWindow.id = 'paintWindow';
            paintWindow.style.width = '700px';
            paintWindow.style.height = '500px';
            paintWindow.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">🎨</div>
                    <div class="window-title">Paint</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Правка</div>
                    <div class="menu-item">Вид</div>
                    <div class="menu-item">Рисунок</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content" style="padding: 0; display: flex; flex-direction: column;">
                    <div style="height: 40px; background: #c0c0c0; border-bottom: 1px solid #808080; display: flex; align-items: center; padding: 0 8px; gap: 4px;">
                        <div class="toolbar-button" title="Карандаш">✏️</div>
                        <div class="toolbar-button" title="Кисть">🖌️</div>
                        <div class="toolbar-button" title="Заливка">🪣</div>
                        <div class="toolbar-button" title="Ластик">🧽</div>
                        <div class="toolbar-button" title="Очистить">🗑️</div>
                        <div style="margin-left: 20px; display: flex; gap: 2px;">
                            ${['#000', '#fff', '#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'].map(color => 
                                `<div style="width: 20px; height: 20px; background: ${color}; border: 1px solid #808080; cursor: pointer;" onclick="selectPaintColor('${color}')"></div>`
                            ).join('')}
                        </div>
                    </div>
                    <div style="flex: 1; padding: 8px;">
                        <canvas id="paintCanvas" width="650" height="400" style="border: 1px inset #c0c0c0; background: white; cursor: crosshair;"></canvas>
                    </div>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">Готов</div>
                    <div class="status-panel">Размер: 650x400</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(paintWindow);

            // Файловый менеджер
            const fileManagerWindow = document.createElement('div');
            fileManagerWindow.className = 'window';
            fileManagerWindow.id = 'filemanagerWindow';
            fileManagerWindow.style.width = '600px';
            fileManagerWindow.style.height = '450px';
            fileManagerWindow.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">📁</div>
                    <div class="window-title">Мой компьютер</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Правка</div>
                    <div class="menu-item">Вид</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 20px; padding: 20px;">
                        <div style="text-align: center; cursor: pointer; padding: 10px;" onclick="openDrive('C')">
                            <div style="font-size: 48px; margin-bottom: 8px;">💽</div>
                            <div style="font-size: 12px;">Диск (C:)</div>
                            <div style="font-size: 10px; color: #666;">15.2 ГБ свободно</div>
                        </div>
                        <div style="text-align: center; cursor: pointer; padding: 10px;" onclick="openDrive('D')">
                            <div style="font-size: 48px; margin-bottom: 8px;">💿</div>
                            <div style="font-size: 12px;">Диск (D:)</div>
                            <div style="font-size: 10px; color: #666;">CD-ROM</div>
                        </div>
                        <div style="text-align: center; cursor: pointer; padding: 10px;" onclick="openDrive('A')">
                            <div style="font-size: 48px; margin-bottom: 8px;">💾</div>
                            <div style="font-size: 12px;">Диск (A:)</div>
                            <div style="font-size: 10px; color: #666;">3.5 дискета</div>
                        </div>
                        <div style="text-align: center; cursor: pointer; padding: 10px;" onclick="openFolder('Documents')">
                            <div style="font-size: 48px; margin-bottom: 8px;">📁</div>
                            <div style="font-size: 12px;">Мои документы</div>
                            <div style="font-size: 10px; color: #666;">Папка</div>
                        </div>
                        <div style="text-align: center; cursor: pointer; padding: 10px;" onclick="openControlPanel()">
                            <div style="font-size: 48px; margin-bottom: 8px;">⚙️</div>
                            <div style="font-size: 12px;">Панель управления</div>
                            <div style="font-size: 10px; color: #666;">Настройки</div>
                        </div>
                        <div style="text-align: center; cursor: pointer; padding: 10px;" onclick="openRecycleBin()">
                            <div style="font-size: 48px; margin-bottom: 8px;">🗑️</div>
                            <div style="font-size: 12px;">Корзина</div>
                            <div style="font-size: 10px; color: #666;">3 объекта</div>
                        </div>
                    </div>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">6 объектов</div>
                    <div class="status-panel">Мой компьютер</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(fileManagerWindow);

            // Дополнительные системные окна
            createAdditionalSystemWindows();
        }

        function createAdditionalSystemWindows() {
            // Сапер
            const minesweeperWindow = document.createElement('div');
            minesweeperWindow.className = 'window';
            minesweeperWindow.id = 'minesweeperWindow';
            minesweeperWindow.style.width = '320px';
            minesweeperWindow.style.height = '400px';
            minesweeperWindow.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">💣</div>
                    <div class="window-title">Сапер</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Игра</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div class="status-panel" style="font-family: monospace; color: red;">010</div>
                        <div class="app-button" onclick="resetMinesweeper()" style="font-size: 16px;">🙂</div>
                        <div class="status-panel" style="font-family: monospace; color: red;">000</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 1px; background: #808080; padding: 4px;">
                        ${Array(100).fill().map((_, i) => 
                            `<div class="mine-cell" style="width: 24px; height: 24px; background: #c0c0c0; border: 1px outset #c0c0c0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold;" onclick="revealMineCell(${i})" oncontextmenu="flagMineCell(${i}); return false;"></div>`
                        ).join('')}
                    </div>
                </div>
            `;
            document.getElementById('desktop').appendChild(minesweeperWindow);

            // Пасьянс
            const solitaireWindow = document.createElement('div');
            solitaireWindow.className = 'window';
            solitaireWindow.id = 'solitaireWindow';
            solitaireWindow.style.width = '700px';
            solitaireWindow.style.height = '500px';
            solitaireWindow.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">🃏</div>
                    <div class="window-title">Пасьянс</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Игра</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content" style="background: #008000; padding: 15px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div class="app-button" onclick="newSolitaireGame()">🆕 Новая игра</div>
                        <div class="app-button" onclick="undoSolitaireMove()">↶ Отменить</div>
                        <div class="app-button" onclick="solitaireHint()">💡 Подсказка</div>
                    </div>
                    <div style="display: flex; justify-content: space-around; margin-bottom: 30px;">
                        <div class="card-foundation" style="width: 70px; height: 90px; border: 2px dashed #ffffff; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px;">♠️</div>
                        <div class="card-foundation" style="width: 70px; height: 90px; border: 2px dashed #ffffff; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px;">♥️</div>
                        <div class="card-foundation" style="width: 70px; height: 90px; border: 2px dashed #ffffff; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px;">♦️</div>
                        <div class="card-foundation" style="width: 70px; height: 90px; border: 2px dashed #ffffff; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px;">♣️</div>
                    </div>
                    <div style="display: flex; justify-content: space-around;">
                        ${Array(7).fill().map((_, i) => 
                            `<div class="card-column" style="width: 70px; min-height: 90px; position: relative;">
                                <div style="width: 70px; height: 90px; background: #000080; border: 2px solid white; border-radius: 8px; position: absolute; top: 0;"></div>
                            </div>`
                        ).join('')}
                    </div>
                    <div style="margin-top: 20px; text-align: center; color: white; font-family: monospace;">
                        Очки: <span id="solitaire-score">0</span> | Время: <span id="solitaire-time">00:00</span>
                    </div>
                </div>
            `;
            document.getElementById('desktop').appendChild(solitaireWindow);

            // Медиаплеер
            const mediaPlayerWindow = document.createElement('div');
            mediaPlayerWindow.className = 'window';
            mediaPlayerWindow.id = 'mediaplayerWindow';
            mediaPlayerWindow.style.width = '450px';
            mediaPlayerWindow.style.height = '350px';
            mediaPlayerWindow.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">🎵</div>
                    <div class="window-title">Windows Media Player</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Вид</div>
                    <div class="menu-item">Воспроизведение</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content">
                    <div class="media-display" style="height: 160px; background: #000; color: #00ff00; display: flex; align-items: center; justify-content: center; font-size: 18px; margin-bottom: 15px;">
                        ♪ Windows Media Player ♪
                    </div>
                    <div style="margin: 10px 0; background: #c0c0c0; border: 1px inset #c0c0c0; height: 20px; display: flex; align-items: center; padding: 0 5px;">
                        <span style="font-size: 10px; margin-right: 5px;">00:00</span>
                        <div style="flex: 1; height: 8px; background: #808080; border: 1px inset #c0c0c0; position: relative;">
                            <div style="width: 25%; height: 100%; background: linear-gradient(to right, #0080ff, #00ff80);"></div>
                        </div>
                        <span style="font-size: 10px; margin-left: 5px;">04:23</span>
                    </div>
                    <div class="media-controls" style="margin: 15px 0;">
                        <div class="media-button" onclick="mediaAction('prev')">⏮️</div>
                        <div class="media-button" onclick="mediaAction('play')">▶️</div>
                        <div class="media-button" onclick="mediaAction('pause')">⏸️</div>
                        <div class="media-button" onclick="mediaAction('stop')">⏹️</div>
                        <div class="media-button" onclick="mediaAction('next')">⏭️</div>
                        <div class="media-button" onclick="mediaAction('volume')">🔊</div>
                        <div class="media-button" onclick="mediaAction('fullscreen')">⛶</div>
                    </div>
                    <div style="text-align: center; font-size: 10px;">
                        <div>Сейчас играет: Example Song.mp3</div>
                        <div>Исполнитель: Unknown Artist</div>
                    </div>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">Остановлено</div>
                    <div class="status-panel">Стерео 44 кГц</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(mediaPlayerWindow);

            // Терминал
            const terminalWindow = document.createElement('div');
            terminalWindow.className = 'window';
            terminalWindow.id = 'terminalWindow';
            terminalWindow.style.width = '600px';
            terminalWindow.style.height = '400px';
            terminalWindow.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">💻</div>
                    <div class="window-title">Командная строка MS-DOS</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-content" style="padding: 0; background: #000; color: #c0c0c0; font-family: 'Courier New', monospace; font-size: 12px;">
                    <div style="padding: 10px; height: 100%; overflow-y: auto;" id="terminalOutput">
                        <div>Microsoft Windows 98 [Версия 4.10.2222]</div>
                        <div>(C) Корпорация Майкрософт, 1981-1998.</div>
                        <div></div>
                        <div id="terminalPrompt">C:\\WINDOWS></div>
                    </div>
                    <input type="text" class="selectable" id="terminalInput" style="position: absolute; bottom: 0; left: 0; width: 100%; background: transparent; border: none; color: #c0c0c0; font-family: 'Courier New', monospace; font-size: 12px; padding: 0 10px; outline: none;" placeholder="">
                </div>
            `;
            document.getElementById('desktop').appendChild(terminalWindow);

            // Настройка терминала
            setTimeout(() => {
                const terminalInput = document.getElementById('terminalInput');
                if (terminalInput) {
                    terminalInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            const command = this.value.trim();
                            const output = document.getElementById('terminalOutput');
                            
                            // Добавляем команду в вывод
                            const commandLine = document.createElement('div');
                            commandLine.textContent = `C:\\WINDOWS>${command}`;
                            output.appendChild(commandLine);
                            
                            // Обрабатываем команду
                            executeTerminalCommand(command);
                            this.value = '';
                            
                            // Прокручиваем вниз
                            output.scrollTop = output.scrollHeight;
                        }
                    });
                }
            }, 1000);
        }

        function executeTerminalCommand(command) {
            const output = document.getElementById('terminalOutput');
            const cmd = command.toLowerCase();
            let response = '';
            
            switch(cmd) {
                case 'dir':
                    response = ` Том в устройстве C имеет метку SYSTEM
 Серийный номер тома: 1A2B-3C4D

 Содержимое папки C:\\WINDOWS

16.07.1998  14:32    <DIR>          .
16.07.1998  14:32    <DIR>          ..
15.06.1998  12:00    <DIR>          SYSTEM
15.06.1998  12:00    <DIR>          SYSTEM32
15.06.1998  12:00    <DIR>          FONTS
15.06.1998  12:00    <DIR>          TEMP
15.06.1998  12:00       286,720    NOTEPAD.EXE
15.06.1998  12:00        32,768    CALC.EXE
15.06.1998  12:00     1,421,312    EXPLORER.EXE
               3 файлов      1,740,800 байт
               6 папок    245,760,000 байт свободно`;
                    break;
                case 'cls':
                    output.innerHTML = `
                        <div>Microsoft Windows 98 [Версия 4.10.2222]</div>
                        <div>(C) Корпорация Майкрософт, 1981-1998.</div>
                        <div></div>
                        <div id="terminalPrompt">C:\\WINDOWS></div>
                    `;
                    return;
                case 'ver':
                    response = 'Microsoft Windows 98 [Версия 4.10.2222]';
                    break;
                case 'time':
                    response = `Текущее время: ${new Date().toLocaleTimeString()}`;
                    break;
                case 'date':
                    response = `Текущая дата: ${new Date().toLocaleDateString()}`;
                    break;
                case 'mem':
                    response = `Память системы:
 Общая память: 65,536 КБ
 Доступная память: 45,231 КБ
 Расширенная память: 32,768 КБ
 Свободная расширенная: 28,945 КБ`;
                    break;
                case 'help':
                    response = `Доступные команды:
DIR     - Вывод списка файлов и папок
CLS     - Очистка экрана
VER     - Версия Windows
TIME    - Текущее время
DATE    - Текущая дата
MEM     - Информация о памяти
HELP    - Справка по командам
EXIT    - Выход из командной строки
NOTEPAD - Запуск Блокнота
CALC    - Запуск Калькулятора
EXPLORER- Запуск Проводника`;
                    break;
                case 'exit':
                    closeWindow('terminal');
                    return;
                case 'notepad':
                    openApp('notepad');
                    response = 'Запуск Блокнота...';
                    break;
                case 'calc':
                    openApp('calculator');
                    response = 'Запуск Калькулятора...';
                    break;
                case 'explorer':
                    openApp('filemanager');
                    response = 'Запуск Проводника...';
                    break;
                default:
                    response = `'${command}' не является внутренней или внешней командой,
исполняемой программой или пакетным файлом.`;
            }
            
            const responseLine = document.createElement('div');
            responseLine.innerHTML = response.replace(/\n/g, '<br>');
            output.appendChild(responseLine);
            
            const promptLine = document.createElement('div');
            promptLine.innerHTML = 'C:\\WINDOWS>';
            promptLine.id = 'terminalPrompt';
            output.appendChild(promptLine);
        }

        // Активация окна
        function activateWindow(windowElement) {
            document.querySelectorAll('.window').forEach(w => {
                w.classList.remove('active');
                w.classList.add('inactive');
            });
            
            windowElement.classList.add('active');
            windowElement.classList.remove('inactive');
            windowElement.style.zIndex = ++zIndexCounter;
            activeWindow = windowElement;
            
            updateTaskbar();
        }

        // Панель задач
        function updateTaskbar() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            openWindows.forEach(appName => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `<span style="margin-right: 4px;">${getAppIcon(appName)}</span>${getAppTitle(appName)}`;
                taskItem.onclick = () => {
                    const windowElement = document.getElementById(appName + 'Window');
                    if (windowElement.style.display === 'none') {
                        windowElement.style.display = 'block';
                    }
                    activateWindow(windowElement);
                };
                
                const windowElement = document.getElementById(appName + 'Window');
                if (windowElement && windowElement.classList.contains('active')) {
                    taskItem.classList.add('active');
                }
                
                taskList.appendChild(taskItem);
            });
        }

        function getAppIcon(appName) {
            const icons = {
                'browser': '🌐',
                'filemanager': '📁',
                'calculator': '🔢',
                'notepad': '📝',
                'paint': '🎨',
                'appstore': '🏪',
                'minesweeper': '💣',
                'solitaire': '🃏',
                'mediaplayer': '🎵',
                'terminal': '💻'
            };
            
            // Проверяем установленные приложения
            const app = appDatabase.find(a => a.id === appName);
            if (app) return app.icon;
            
            return icons[appName] || '📄';
        }

        function getAppTitle(appName) {
            const titles = {
                'browser': 'Internet Explorer',
                'filemanager': 'Мой компьютер',
                'calculator': 'Калькулятор',
                'notepad': 'Блокнот',
                'paint': 'Paint',
                'appstore': 'Магазин приложений',
                'minesweeper': 'Сапер',
                'solitaire': 'Пасьянс',
                'mediaplayer': 'Проигрыватель',
                'terminal': 'Командная строка'
            };
            
            // Проверяем установленные приложения
            const app = appDatabase.find(a => a.id === appName);
            if (app) return app.name;
            
            return titles[appName] || appName;
        }

        // Управление окнами
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('window-control')) {
                const action = e.target.dataset.action;
                const windowElement = e.target.closest('.window');
                const appName = windowElement.id.replace('Window', '');
                
                switch(action) {
                    case 'close':
                        closeWindow(appName);
                        break;
                    case 'minimize':
                        minimizeWindow(windowElement);
                        break;
                    case 'maximize':
                        maximizeWindow(windowElement);
                        break;
                }
            }
        });

        function closeWindow(appName) {
            const windowElement = document.getElementById(appName + 'Window');
            windowElement.style.display = 'none';
            openWindows.delete(appName);
            updateTaskbar();
        }

        function minimizeWindow(windowElement) {
            windowElement.style.display = 'none';
        }

        function maximizeWindow(windowElement) {
            if (windowElement.classList.contains('maximized')) {
                windowElement.classList.remove('maximized');
                windowElement.style.width = '';
                windowElement.style.height = '';
                windowElement.style.top = '';
                windowElement.style.left = '';
            } else {
                windowElement.classList.add('maximized');
                windowElement.style.width = '100vw';
                windowElement.style.height = 'calc(100vh - 30px)';
                windowElement.style.top = '0';
                windowElement.style.left = '0';
            }
        }

        // Перетаскивание окон
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        document.addEventListener('mousedown', function(e) {
            const titlebar = e.target.closest('.window-titlebar');
            if (titlebar && !e.target.classList.contains('window-control')) {
                isDragging = true;
                const windowElement = titlebar.closest('.window');
                activateWindow(windowElement);
                
                const rect = windowElement.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                
                document.addEventListener('mousemove', dragWindow);
                document.addEventListener('mouseup', stopDrag);
            }
        });

        function dragWindow(e) {
            if (!isDragging || !activeWindow) return;
            
            const x = e.clientX - dragOffsetX;
            const y = e.clientY - dragOffsetY;
            
            activeWindow.style.left = Math.max(0, Math.min(x, window.innerWidth - 200)) + 'px';
            activeWindow.style.top = Math.max(0, Math.min(y, window.innerHeight - 100)) + 'px';
        }

        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', dragWindow);
            document.removeEventListener('mouseup', stopDrag);
        }

        // ИСПРАВЛЕН: Браузер с полноэкранными сайтами
        function navigateToUrl() {
            const url = document.getElementById('addressInput').value.trim();
            if (!url) return;
            
            let finalUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                finalUrl = 'https://' + url;
                document.getElementById('addressInput').value = finalUrl;
            }
            
            // Создаем iframe на весь экран браузера
            const browserFrame = document.getElementById('browserFrame');
            browserFrame.innerHTML = `<iframe src="${finalUrl}" class="browser-iframe" title="Browser Content" allow="fullscreen"></iframe>`;
            
            document.getElementById('browserStatus').textContent = 'Загрузка...';
            
            setTimeout(() => {
                document.getElementById('browserStatus').textContent = 'Готов';
            }, 3000);
        }

        function navigateTo(url) {
            document.getElementById('addressInput').value = url;
            navigateToUrl();
        }

        function browserAction(action) {
            switch(action) {
                case 'back':
                    showNotification('Переход назад');
                    break;
                case 'forward':
                    showNotification('Переход вперед');
                    break;
                case 'refresh':
                    navigateToUrl();
                    showNotification('Страница обновлена');
                    break;
                case 'home':
                    navigateTo('https://www.google.com');
                    break;
                case 'search':
                    navigateTo('https://www.google.com');
                    break;
                case 'favorites':
                    showNotification('Избранное');
                    break;
            }
        }

        // ИСПРАВЛЕН: Магазин приложений
        function loadStoreApps() {
            const storeApps = document.getElementById('storeApps');
            storeApps.innerHTML = '';
            
            appDatabase.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'app-item';
                appItem.innerHTML = `
                    <div class="app-icon">${app.icon}</div>
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-developer">${app.developer}</div>
                        <div class="app-description">${app.description}</div>
                        <div class="app-rating">⭐⭐⭐⭐⭐ ${app.rating}/5.0 | ${app.size}</div>
                    </div>
                    <div class="app-actions">
                        <div class="app-button ${installedApps.has(app.id) ? 'installed' : ''}" 
                             onclick="installApp('${app.id}')">
                            ${installedApps.has(app.id) ? '✅ Установлено' : '📥 Установить'}
                        </div>
                        <div class="app-button" onclick="openApp('${app.id}')">▶️ Запустить</div>
                    </div>
                `;
                storeApps.appendChild(appItem);
            });
        }

        function installApp(appId) {
            const app = appDatabase.find(a => a.id === appId);
            if (!app) return;
            
            if (installedApps.has(appId)) {
                showNotification(`${app.name} уже установлено`);
                return;
            }
            
            // Эмуляция установки с прогрессом
            showNotification(`Начинается установка ${app.name}...`);
            
            setTimeout(() => {
                showNotification(`Загрузка ${app.name}... 25%`);
            }, 500);
            
            setTimeout(() => {
                showNotification(`Установка ${app.name}... 50%`);
            }, 1000);
            
            setTimeout(() => {
                showNotification(`Завершение установки ${app.name}... 75%`);
            }, 1500);
            
            setTimeout(() => {
                installedApps.add(appId);
                showNotification(`✅ ${app.name} успешно установлено!`);
                loadStoreApps(); // Обновить интерфейс
                
                // Добавить на рабочий стол
                addToDesktop(app);
            }, 2000);
        }

        function addToDesktop(app) {
            const desktopIcons = document.querySelector('.desktop-icons');
            const icon = document.createElement('div');
            icon.className = 'desktop-icon';
            icon.dataset.app = app.id;
            icon.innerHTML = `
                <div class="icon-image">${app.icon}</div>
                <div class="icon-label">${app.name}</div>
            `;
            desktopIcons.appendChild(icon);
        }

        function filterApps(category) {
            document.querySelectorAll('.store-category').forEach(cat => {
                cat.classList.remove('active');
            });
            
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            const storeApps = document.getElementById('storeApps');
            storeApps.innerHTML = '';
            
            const filteredApps = category === 'all' ? appDatabase : appDatabase.filter(app => app.category === category);
            
            filteredApps.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'app-item';
                appItem.innerHTML = `
                    <div class="app-icon">${app.icon}</div>
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-developer">${app.developer}</div>
                        <div class="app-description">${app.description}</div>
                        <div class="app-rating">⭐⭐⭐⭐⭐ ${app.rating}/5.0 | ${app.size}</div>
                    </div>
                    <div class="app-actions">
                        <div class="app-button ${installedApps.has(app.id) ? 'installed' : ''}" 
                             onclick="installApp('${app.id}')">
                            ${installedApps.has(app.id) ? '✅ Установлено' : '📥 Установить'}
                        </div>
                        <div class="app-button" onclick="openApp('${app.id}')">▶️ Запустить</div>
                    </div>
                `;
                storeApps.appendChild(appItem);
            });
        }

        function searchApps(query) {
            if (!query.trim()) {
                loadStoreApps();
                return;
            }
            
            const storeApps = document.getElementById('storeApps');
            storeApps.innerHTML = '';
            
            const filteredApps = appDatabase.filter(app => 
                app.name.toLowerCase().includes(query.toLowerCase()) ||
                app.developer.toLowerCase().includes(query.toLowerCase()) ||
                app.description.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredApps.length === 0) {
                storeApps.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 20px;">🔍</div>
                        <h3>Ничего не найдено</h3>
                        <p>Попробуйте изменить поисковый запрос</p>
                    </div>
                `;
                return;
            }
            
            filteredApps.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'app-item';
                appItem.innerHTML = `
                    <div class="app-icon">${app.icon}</div>
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-developer">${app.developer}</div>
                        <div class="app-description">${app.description}</div>
                        <div class="app-rating">⭐⭐⭐⭐⭐ ${app.rating}/5.0 | ${app.size}</div>
                    </div>
                    <div class="app-actions">
                        <div class="app-button ${installedApps.has(app.id) ? 'installed' : ''}" 
                             onclick="installApp('${app.id}')">
                            ${installedApps.has(app.id) ? '✅ Установлено' : '📥 Установить'}
                        </div>
                        <div class="app-button" onclick="openApp('${app.id}')">▶️ Запустить</div>
                    </div>
                `;
                storeApps.appendChild(appItem);
            });
        }

        function refreshStore() {
            loadStoreApps();
            showNotification('🔄 Магазин приложений обновлен');
        }

        // Калькулятор
        function calcAction(action) {
            const display = document.getElementById('calcDisplay');
            
            if (action === 'clear') {
                calcDisplay = '0';
                calcExpression = '';
            } else if (action === 'ce') {
                calcDisplay = '0';
            } else if (action === 'backspace') {
                if (calcDisplay.length > 1) {
                    calcDisplay = calcDisplay.slice(0, -1);
                    calcExpression = calcExpression.slice(0, -1);
                } else {
                    calcDisplay = '0';
                    calcExpression = '';
                }
            } else if (action === '=') {
                try {
                    const result = eval(calcExpression);
                    calcDisplay = result.toString();
                    calcExpression = result.toString();
                } catch (error) {
                    calcDisplay = 'Ошибка';
                    calcExpression = '';
                }
            } else {
                if (calcDisplay === '0' && !isNaN(action)) {
                    calcDisplay = action;
                    calcExpression = action;
                } else {
                    calcDisplay += action;
                    calcExpression += action;
                }
            }
            
            display.textContent = calcDisplay;
        }

        // Меню Пуск
        function toggleStartMenu() {
            const startMenu = document.getElementById('startMenu');
            startMenu.classList.toggle('show');
        }

        // Системные функции
        function showDesktop() {
            document.querySelectorAll('.window').forEach(w => {
                w.style.display = 'none';
            });
        }

        function showVolumeControl() {
            showNotification('🔊 Громкость: 75%');
        }

        function showNetworkStatus() {
            showNotification('📶 Сеть: Подключено к Интернету (56K модем)');
        }

        function showAntivirus() {
            showDialog('Norton AntiVirus', '🛡️', 
                'Система защищена\n\nПоследняя проверка: Сегодня, 14:32\nСтатус: Активная защита\nОбнаружено угроз: 0\nБаза данных: Актуальна');
        }

        function showRunDialog() {
            showDialog('Запуск программы', '▶️', 
                'Введите имя программы, папки, документа или ресурса Интернета:<br><br><input type="text" id="runInput" class="selectable" style="width: 200px; padding: 2px; border: 1px inset #c0c0c0;" placeholder="Например: calc">',
                [
                    { text: 'OK', action: 'executeRun()', default: true },
                    { text: 'Отмена', action: 'closeDialog()' },
                    { text: 'Обзор...', action: 'browseFiles()' }
                ]);
        }

        function executeRun() {
            const input = document.getElementById('runInput');
            if (!input) return;
            
            const cmd = input.value.toLowerCase().trim();
            const commands = {
                'calc': 'calculator',
                'notepad': 'notepad',
                'mspaint': 'paint',
                'paint': 'paint',
                'iexplore': 'browser',
                'explorer': 'filemanager',
                'winmine': 'minesweeper',
                'sol': 'solitaire',
                'cmd': 'terminal',
                'command': 'terminal'
            };
            
            if (commands[cmd]) {
                openApp(commands[cmd]);
                showNotification(`Запуск ${commands[cmd]}...`);
            } else {
                showNotification(`Программа "${cmd}" не найдена`);
            }
            
            closeDialog();
        }

        function browseFiles() {
            showNotification('Открытие диалога выбора файла...');
        }

        function showShutdown() {
            showDialog('Завершение работы Windows', '⚡', 
                'Что вы хотите сделать?<br><br>' +
                '<label><input type="radio" name="shutdown" value="shutdown" checked> Завершить работу компьютера</label><br>' +
                '<label><input type="radio" name="shutdown" value="restart"> Перезагрузить компьютер</label><br>' +
                '<label><input type="radio" name="shutdown" value="logoff"> Завершить сеанс пользователя</label>',
                [
                    { text: 'OK', action: 'doShutdown()', default: true },
                    { text: 'Отмена', action: 'closeDialog()' },
                    { text: 'Справка', action: 'showShutdownHelp()' }
                ]);
        }

        function doShutdown() {
            const selected = document.querySelector('input[name="shutdown"]:checked');
            if (!selected) return;
            
            const action = selected.value;
            
            switch(action) {
                case 'shutdown':
                    document.body.style.background = '#000';
                    document.body.innerHTML = `
                        <div style="color: #00ff00; text-align: center; padding-top: 200px; font-size: 24px; font-family: monospace;">
                            <div>Завершение работы Windows...</div>
                            <div style="font-size: 16px; margin-top: 20px;">Теперь компьютер можно выключить</div>
                            <div style="font-size: 12px; margin-top: 40px; color: #666;">Нажмите F5 для перезагрузки</div>
                        </div>
                    `;
                    break;
                case 'restart':
                    showNotification('Перезагрузка системы...');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                    break;
                case 'logoff':
                    isLoggedIn = false;
                    document.getElementById('desktop').classList.remove('show');
                    document.getElementById('loginScreen').classList.remove('hidden');
                    showNotification('Сеанс пользователя завершен');
                    break;
            }
            
            closeDialog();
        }

        function showShutdownHelp() {
            showDialog('Справка по завершению работы', '❓',
                'Выберите одно из следующих действий:\n\n' +
                '• Завершить работу компьютера -
                                <div class="toolbar-button" title="Создать">📄</div>
                                <div class="toolbar-button" title="Открыть">📂</div>
                                <div class="toolbar-button" title="Сохранить">💾</div>
                                <div class="toolbar-button" title="Построить">🔨</div>
                                <div class="toolbar-button" title="Отладка">🐛</div>
                                <div class="toolbar-button" title="Запустить">▶️</div>
                            </div>
                            
                            <div style="flex: 1; background: white; font-family: 'Courier New', monospace; font-size: 12px; padding: 10px; overflow-y: auto;">
                                <div style="color: #008000;">// Visual C++ 6.0 Project</div>
                                <div style="color: #000080;">#include &lt;windows.h&gt;</div>
                                <div style="color: #000080;">#include &lt;iostream&gt;</div>
                                <div></div>
                                <div><span style="color: #0000ff;">int</span> <span style="color: #000080;">main</span>() {</div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">// Основная функция</span></div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000080;">MessageBox</span>(<span style="color: #0000ff;">NULL</span>, <span style="color: #800000;">"Hello World!"</span>, <span style="color: #800000;">"My App"</span>, <span style="color: #0000ff;">MB_OK</span>);</div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span> <span style="color: #ff0000;">0</span>;</div>
                                <div>}</div>
                            </div>
                            
                            <div style="height: 100px; background: #f8f8f8; border-top: 1px solid #999; padding: 5px; font-family: 'Courier New', monospace; font-size: 10px; overflow-y: auto;">
                                <div style="font-weight: bold; margin-bottom: 5px;">Вывод сборки:</div>
                                <div>Компиляция...</div>
                                <div>main.cpp</div>
                                <div>Linking...</div>
                                <div>MyProject.exe - 0 error(s), 0 warning(s)</div>
                                <div style="color: green;">Сборка завершена успешно</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return createDefaultWindow(app);
            }
        }

        function createDefaultWindow(app) {
            return `
                <div style="text-align: center; padding: 50px;">
                    <div style="font-size: 64px; margin-bottom: 20px;">${app.icon}</div>
                    <h2>${app.name}</h2>
                    <p>${app.description}</p>
                    <div style="margin: 20px 0;">
                        <strong>Разработчик:</strong> ${app.developer}<br>
                        <strong>Размер:</strong> ${app.size}<br>
                        <strong>Рейтинг:</strong> ⭐⭐⭐⭐⭐ ${app.rating}/5.0
                    </div>
                    <div style="margin: 20px 0;">
                        <strong>Особенности:</strong><br>
                        ${app.features.map(feature => `• ${feature}`).join('<br>')}
                    </div>
                    <div class="app-button" onclick="launchApp('${app.id}')">🚀 Запустить приложение</div>
                </div>
            `;
        }

        // Создание системных окон
        function createSystemWindows() {
            createNotepadWindow();
            createPaintWindow();
            createFileManagerWindow();
            createMinesweeperWindow();
            createSolitaireWindow();
            createMediaPlayerWindow();
            createTerminalWindow();
        }

        function createNotepadWindow() {
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = 'notepadWindow';
            windowElement.style.width = '600px';
            windowElement.style.height = '400px';
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">📝</div>
                    <div class="window-title">Блокнот - Без названия</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Правка</div>
                    <div class="menu-item">Поиск</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content" style="padding: 0;">
                    <textarea style="width: 100%; height: 100%; border: none; padding: 10px; font-family: 'Courier New', monospace; font-size: 12px; resize: none; outline: none;" placeholder="Введите текст..."></textarea>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">Готов</div>
                    <div class="status-panel">Строка 1, Столбец 1</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(windowElement);
        }

        function createPaintWindow() {
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = 'paintWindow';
            windowElement.style.width = '700px';
            windowElement.style.height = '500px';
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">🎨</div>
                    <div class="window-title">Paint</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Правка</div>
                    <div class="menu-item">Вид</div>
                    <div class="menu-item">Рисунок</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content" style="padding: 0; display: flex; flex-direction: column;">
                    <div style="height: 60px; background: #c0c0c0; border-bottom: 1px solid #808080; display: flex; align-items: center; padding: 4px; gap: 4px;">
                        <div class="toolbar-button" onclick="selectPaintTool('pencil')" title="Карандаш">✏️</div>
                        <div class="toolbar-button" onclick="selectPaintTool('brush')" title="Кисть">🖌️</div>
                        <div class="toolbar-button" onclick="selectPaintTool('eraser')" title="Ластик">🧽</div>
                        <div class="toolbar-button" onclick="selectPaintTool('line')" title="Линия">📏</div>
                        <div class="toolbar-button" onclick="selectPaintTool('rectangle')" title="Прямоугольник">⬜</div>
                        <div class="toolbar-button" onclick="selectPaintTool('circle')" title="Круг">⭕</div>
                        <div class="toolbar-button" onclick="clearPaint()" title="Очистить">🗑️</div>
                        
                        <div style="margin-left: 10px; display: flex; gap: 2px;">
                            ${['#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#800000', '#008000', '#000080', '#808000', '#800080', '#008080', '#c0c0c0', '#808080'].map(color => 
                                `<div style="width: 20px; height: 20px; background: ${color}; border: 1px solid #808080; cursor: pointer;" onclick="selectPaintColor('${color}')"></div>`
                            ).join('')}
                        </div>
                    </div>
                    <div style="flex: 1; padding: 8px; background: #c0c0c0; display: flex; justify-content: center; align-items: center;">
                        <canvas id="paintCanvas" width="600" height="350" style="background: white; border: 1px inset #c0c0c0; cursor: crosshair;"></canvas>
                    </div>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">Готов</div>
                    <div class="status-panel" id="paintToolStatus">Инструмент: Карандаш</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(windowElement);
            
            // Инициализация Paint
            setTimeout(() => {
                setupPaintCanvas();
            }, 100);
        }

        function createFileManagerWindow() {
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = 'filemanagerWindow';
            windowElement.style.width = '600px';
            windowElement.style.height = '450px';
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">📁</div>
                    <div class="window-title">Мой компьютер</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Правка</div>
                    <div class="menu-item">Вид</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 20px; padding: 20px;">
                        <div style="text-align: center; cursor: pointer;" onclick="openDrive('C')">
                            <div style="font-size: 48px; margin-bottom: 8px;">💽</div>
                            <div style="font-size: 11px;">Диск (C:)</div>
                            <div style="font-size: 9px; color: #666;">15.2 GB свободно</div>
                        </div>
                        <div style="text-align: center; cursor: pointer;" onclick="openDrive('D')">
                            <div style="font-size: 48px; margin-bottom: 8px;">💿</div>
                            <div style="font-size: 11px;">Диск (D:)</div>
                            <div style="font-size: 9px; color: #666;">CD-ROM</div>
                        </div>
                        <div style="text-align: center; cursor: pointer;" onclick="openDrive('A')">
                            <div style="font-size: 48px; margin-bottom: 8px;">💾</div>
                            <div style="font-size: 11px;">Диск (A:)</div>
                            <div style="font-size: 9px; color: #666;">1.44 MB</div>
                        </div>
                        <div style="text-align: center; cursor: pointer;" onclick="openFolder('documents')">
                            <div style="font-size: 48px; margin-bottom: 8px;">📁</div>
                            <div style="font-size: 11px;">Мои документы</div>
                        </div>
                        <div style="text-align: center; cursor: pointer;" onclick="openFolder('network')">
                            <div style="font-size: 48px; margin-bottom: 8px;">🌐</div>
                            <div style="font-size: 11px;">Сетевое окружение</div>
                        </div>
                        <div style="text-align: center; cursor: pointer;" onclick="openFolder('printers')">
                            <div style="font-size: 48px; margin-bottom: 8px;">🖨️</div>
                            <div style="font-size: 11px;">Принтеры</div>
                        </div>
                        <div style="text-align: center; cursor: pointer;" onclick="openFolder('control')">
                            <div style="font-size: 48px; margin-bottom: 8px;">⚙️</div>
                            <div style="font-size: 11px;">Панель управления</div>
                        </div>
                        <div style="text-align: center; cursor: pointer;" onclick="openFolder('recycle')">
                            <div style="font-size: 48px; margin-bottom: 8px;">🗑️</div>
                            <div style="font-size: 11px;">Корзина</div>
                        </div>
                    </div>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel">8 объектов</div>
                    <div class="status-panel">Мой компьютер</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(windowElement);
        }

        function createMinesweeperWindow() {
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = 'minesweeperWindow';
            windowElement.style.width = '300px';
            windowElement.style.height = '350px';
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">💣</div>
                    <div class="window-title">Сапер</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Игра</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div style="border: 1px inset #c0c0c0; padding: 2px 6px; background: #000; color: #ff0000; font-family: monospace; font-weight: bold;">010</div>
                            <div style="width: 32px; height: 32px; background: #ffff00; border: 1px outset #c0c0c0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px;" onclick="resetMinesweeper()">🙂</div>
                            <div style="border: 1px inset #c0c0c0; padding: 2px 6px; background: #000; color: #ff0000; font-family: monospace; font-weight: bold;" id="minesweeperTimer">000</div>
                        </div>
                        <div id="minesweeperGrid" style="display: grid; grid-template-columns: repeat(9, 1fr); gap: 1px; background: #808080; padding: 4px; justify-content: center;">
                            ${Array(81).fill().map((_, i) => `<div class="mine-cell" style="width: 20px; height: 20px; background: #c0c0c0; border: 1px outset #c0c0c0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold;" onclick="revealMineCell(${i})" oncontextmenu="toggleMineFlag(${i}); return false;"></div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('desktop').appendChild(windowElement);
        }

        function createSolitaireWindow() {
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = 'solitaireWindow';
            windowElement.style.width = '600px';
            windowElement.style.height = '400px';
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">🃏</div>
                    <div class="window-title">Пасьянс</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Игра</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content" style="background: #008000; padding: 0;">
                    <div style="padding: 10px;">
                        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
                            <div class="app-button" onclick="newSolitaireGame()">🃏 Новая игра</div>
                            <div class="app-button" onclick="undoSolitaireMove()">↶ Отменить</div>
                            <div class="app-button" onclick="solitaireHint()">💡 Подсказка</div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                            <div style="width: 60px; height: 80px; background: #000080; border: 1px solid white; border-radius: 4px; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="dealCards()">🂠</div>
                            <div style="width: 60px; height: 80px; background: white; border: 1px solid #000; border-radius: 4px; display: flex; align-items: center; justify-content: center;">🃁</div>
                            <div style="width: 60px; height: 80px; background: white; border: 1px solid #000; border-radius: 4px; display: flex; align-items: center; justify-content: center;">🂱</div>
                            <div style="width: 60px; height: 80px; background: white; border: 1px solid #000; border-radius: 4px; display: flex; align-items: center; justify-content: center;">🃑</div>
                            <div style="width: 60px; height: 80px; background: white; border: 1px solid #000; border-radius: 4px; display: flex; align-items: center; justify-content: center;">🃋</div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-around;">
                            ${Array(7).fill().map((_, i) => `<div style="width: 60px; height: 80px; background: #000080; border: 1px solid white; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white;" onclick="selectSolitaireColumn(${i})">${i === 0 ? '🂡' : ''}</div>`).join('')}
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px; color: white;">
                            Очки: <span id="solitaireScore">0</span> | Время: <span id="solitaireTime">00:00</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('desktop').appendChild(windowElement);
        }

        function createMediaPlayerWindow() {
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = 'mediaplayerWindow';
            windowElement.style.width = '400px';
            windowElement.style.height = '300px';
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">🎵</div>
                    <div class="window-title">Windows Media Player</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-menubar">
                    <div class="menu-item">Файл</div>
                    <div class="menu-item">Вид</div>
                    <div class="menu-item">Воспроизведение</div>
                    <div class="menu-item">Справка</div>
                </div>
                <div class="window-content">
                    <div class="media-display" style="height: 120px; background: #000; color: #00ff00; display: flex; align-items: center; justify-content: center; font-size: 18px; margin-bottom: 15px;">
                        ♪ Windows Media Player ♪
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 5px; margin-bottom: 15px;">
                        <span style="font-size: 10px;">00:00</span>
                        <div style="flex: 1; height: 12px; background: #808080; border: 1px inset #c0c0c0; position: relative;">
                            <div style="width: 30%; height: 100%; background: linear-gradient(to right, #0080ff, #00ff80);" id="mediaProgress"></div>
                        </div>
                        <span style="font-size: 10px;">03:45</span>
                    </div>
                    
                    <div class="media-controls">
                        <div class="media-button" onclick="mediaPlayerAction('prev')">⏮️</div>
                        <div class="media-button" onclick="mediaPlayerAction('play')">▶️</div>
                        <div class="media-button" onclick="mediaPlayerAction('pause')">⏸️</div>
                        <div class="media-button" onclick="mediaPlayerAction('stop')">⏹️</div>
                        <div class="media-button" onclick="mediaPlayerAction('next')">⏭️</div>
                        <div class="media-button" onclick="mediaPlayerAction('open')">📂</div>
                        <div class="media-button" onclick="mediaPlayerAction('volume')">🔊</div>
                    </div>
                </div>
                <div class="window-statusbar">
                    <div class="status-panel" id="mediaPlayerStatus">Остановлено</div>
                    <div class="status-panel">00:00 / 03:45</div>
                </div>
            `;
            document.getElementById('desktop').appendChild(windowElement);
        }

        function createTerminalWindow() {
            const windowElement = document.createElement('div');
            windowElement.className = 'window';
            windowElement.id = 'terminalWindow';
            windowElement.style.width = '600px';
            windowElement.style.height = '400px';
            windowElement.innerHTML = `
                <div class="window-titlebar">
                    <div class="window-icon">💻</div>
                    <div class="window-title">Командная строка MS-DOS</div>
                    <div class="window-controls">
                        <div class="window-control" data-action="minimize">_</div>
                        <div class="window-control" data-action="maximize">□</div>
                        <div class="window-control" data-action="close">×</div>
                    </div>
                </div>
                <div class="window-content" style="padding: 0; background: #000; color: #c0c0c0; font-family: 'Courier New', monospace; font-size: 12px; position: relative;">
                    <div style="padding: 10px; height: 100%; overflow-y: auto;" id="terminalOutput">
                        <div>Microsoft Windows 98 [Версия 4.10.2222]</div>
                        <div>(C) Корпорация Майкрософт, 1981-1998.</div>
                        <div></div>
                        <div>C:\\WINDOWS></div>
                    </div>
                    <input type="text" id="terminalInput" style="position: absolute; bottom: 0; left: 0; width: 100%; background: transparent; border: none; color: #c0c0c0; font-family: 'Courier New', monospace; font-size: 12px; padding: 0 10px; outline: none;">
                </div>
            `;
            document.getElementById('desktop').appendChild(windowElement);
            
            // Инициализация терминала
            setTimeout(() => {
                setupTerminal();
            }, 100);
        }

        // Активация окна
        function activateWindow(windowElement) {
            document.querySelectorAll('.window').forEach(w => {
                w.classList.remove('active');
                w.classList.add('inactive');
            });
            
            windowElement.classList.add('active');
            windowElement.classList.remove('inactive');
            windowElement.style.zIndex = ++zIndexCounter;
            activeWindow = windowElement;
            
            updateTaskbar();
        }

        // Панель задач
        function updateTaskbar() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            openWindows.forEach(appName => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `<span style="margin-right: 4px;">${getAppIcon(appName)}</span>${getAppTitle(appName)}`;
                taskItem.onclick = () => {
                    const windowElement = document.getElementById(appName + 'Window');
                    if (windowElement.style.display === 'none') {
                        windowElement.style.display = 'block';
                    }
                    activateWindow(windowElement);
                };
                
                const windowElement = document.getElementById(appName + 'Window');
                if (windowElement && windowElement.classList.contains('active')) {
                    taskItem.classList.add('active');
                }
                
                taskList.appendChild(taskItem);
            });
        }

        function getAppIcon(appName) {
            const icons = {
                'browser': '🌐',
                'filemanager': '📁',
                'calculator': '🔢',
                'notepad': '📝',
                'paint': '🎨',
                'appstore': '🏪',
                'minesweeper': '💣',
                'solitaire': '🃏',
                'mediaplayer': '🎵',
                'terminal': '💻'
            };
            
            // Проверяем установленные приложения
            const app = appDatabase.find(a => a.id === appName);
            if (app) return app.icon;
            
            return icons[appName] || '📄';
        }

        function getAppTitle(appName) {
            const titles = {
                'browser': 'Internet Explorer',
                'filemanager': 'Мой компьютер',
                'calculator': 'Калькулятор',
                'notepad': 'Блокнот',
                'paint': 'Paint',
                'appstore': 'Магазин приложений',
                'minesweeper': 'Сапер',
                'solitaire': 'Пасьянс',
                'mediaplayer': 'Проигрыватель',
                'terminal': 'Командная строка'
            };
            
            // Проверяем установленные приложения
            const app = appDatabase.find(a => a.id === appName);
            if (app) return app.name;
            
            return titles[appName] || appName;
        }

        // Управление окнами
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('window-control')) {
                const action = e.target.dataset.action;
                const windowElement = e.target.closest('.window');
                const appName = windowElement.id.replace('Window', '');
                
                switch(action) {
                    case 'close':
                        closeWindow(appName);
                        break;
                    case 'minimize':
                        minimizeWindow(windowElement);
                        break;
                    case 'maximize':
                        maximizeWindow(windowElement);
                        break;
                }
            }
        });

        function closeWindow(appName) {
            const windowElement = document.getElementById(appName + 'Window');
            windowElement.style.display = 'none';
            openWindows.delete(appName);
            updateTaskbar();
        }

        function minimizeWindow(windowElement) {
            windowElement.style.display = 'none';
        }

        function maximizeWindow(windowElement) {
            if (windowElement.classList.contains('maximized')) {
                windowElement.classList.remove('maximized');
                windowElement.style.width = '';
                windowElement.style.height = '';
                windowElement.style.top = '';
                windowElement.style.left = '';
            } else {
                windowElement.classList.add('maximized');
                windowElement.style.width = '100vw';
                windowElement.style.height = 'calc(100vh - 30px)';
                windowElement.style.top = '0';
                windowElement.style.left = '0';
            }
        }

        // Перетаскивание окон
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        document.addEventListener('mousedown', function(e) {
            const titlebar = e.target.closest('.window-titlebar');
            if (titlebar && !e.target.classList.contains('window-control')) {
                isDragging = true;
                const windowElement = titlebar.closest('.window');
                activateWindow(windowElement);
                
                const rect = windowElement.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                
                document.addEventListener('mousemove', dragWindow);
                document.addEventListener('mouseup', stopDrag);
            }
        });

        function dragWindow(e) {
            if (!isDragging || !activeWindow) return;
            
            const x = e.clientX - dragOffsetX;
            const y = e.clientY - dragOffsetY;
            
            activeWindow.style.left = Math.max(0, Math.min(x, window.innerWidth - 200)) + 'px';
            activeWindow.style.top = Math.max(0, Math.min(y, window.innerHeight - 100)) + 'px';
        }

        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', dragWindow);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Браузер - ПОЛНОСТЬЮ ИСПРАВЛЕН
        function navigateToUrl() {
            const url = document.getElementById('addressInput').value.trim();
            if (!url) return;
            
            let finalUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                finalUrl = 'https://' + url;
                document.getElementById('addressInput').value = finalUrl;
            }
            
            // Создаем iframe для загрузки реального сайта на весь экран браузера
            const browserFrame = document.getElementById('browserFrame');
            browserFrame.innerHTML = `<iframe src="${finalUrl}" class="browser-iframe" title="Browser Content" allow="fullscreen"></iframe>`;
            
            document.getElementById('browserStatus').textContent = 'Загрузка...';
            
            setTimeout(() => {
                document.getElementById('browserStatus').textContent = 'Готов';
            }, 2000);
        }

        function navigateTo(url) {
            document.getElementById('addressInput').value = url;
            navigateToUrl();
        }

        function browserAction(action) {
            switch(action) {
                case 'back':
                    showNotification('Переход назад');
                    break;
                case 'forward':
                    showNotification('Переход вперед');
                    break;
                case 'refresh':
                    navigateToUrl();
                    showNotification('Страница обновлена');
                    break;
                case 'home':
                    navigateTo('https://www.google.com');
                    break;
                case 'search':
                    navigateTo('https://www.google.com');
                    break;
                case 'favorites':
                    showNotification('Открыто избранное');
                    break;
                case 'stop':
                    showNotification('Загрузка остановлена');
                    break;
            }
        }

        // Магазин приложений
        function loadStoreApps() {
            const storeApps = document.getElementById('storeApps');
            storeApps.innerHTML = '';
            
            appDatabase.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'app-item';
                appItem.innerHTML = `
                    <div class="app-icon">${app.icon}</div>
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-developer">${app.developer}</div>
                        <div class="app-description">${app.description}</div>
                        <div class="app-rating">★★★★☆ ${app.rating} | ${app.size}</div>
                    </div>
                    <div class="app-actions">
                        <div class="app-button ${installedApps.has(app.id) ? 'installed' : ''}" 
                             onclick="installApp('${app.id}')">
                            ${installedApps.has(app.id) ? 'Установлено' : 'Установить'}
                        </div>
                        <div class="app-button" onclick="openApp('${app.id}')">Запустить</div>
                    </div>
                `;
                storeApps.appendChild(appItem);
            });
        }

        function installApp(appId) {
            const app = appDatabase.find(a => a.id === appId);
            if (!app) return;
            
            if (installedApps.has(appId)) {
                showNotification(`${app.name} уже установлено`);
                return;
            }
            
            // Эмуляция установки
            showNotification(`Установка ${app.name}...`);
            
            setTimeout(() => {
                installedApps.add(appId);
                showNotification(`${app.name} успешно установлено!`);
                loadStoreApps(); // Обновить интерфейс
                
                // Добавить на рабочий стол
                addToDesktop(app);
            }, 2000);
        }

        function addToDesktop(app) {
            const desktopIcons = document.querySelector('.desktop-icons');
            const icon = document.createElement('div');
            icon.className = 'desktop-icon';
            icon.dataset.app = app.id;
            icon.innerHTML = `
                <div class="icon-image">${app.icon}</div>
                <div class="icon-label">${app.name}</div>
            `;
            desktopIcons.appendChild(icon);
        }

        function filterApps(category) {
            document.querySelectorAll('.store-category').forEach(cat => {
                cat.classList.remove('active');
            });
            
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            const storeApps = document.getElementById('storeApps');
            storeApps.innerHTML = '';
            
            const filteredApps = category === 'all' ? appDatabase : appDatabase.filter(app => app.category === category);
            
            filteredApps.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'app-item';
                appItem.innerHTML = `
                    <div class="app-icon">${app.icon}</div>
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-developer">${app.developer}</div>
                        <div class="app-description">${app.description}</div>
                        <div class="app-rating">★★★★☆ ${app.rating} | ${app.size}</div>
                    </div>
                    <div class="app-actions">
                        <div class="app-button ${installedApps.has(app.id) ? 'installed' : ''}" 
                             onclick="installApp('${app.id}')">
                            ${installedApps.has(app.id) ? 'Установлено' : 'Установить'}
                        </div>
                        <div class="app-button" onclick="openApp('${app.id}')">Запустить</div>
                    </div>
                `;
                storeApps.appendChild(appItem);
            });
        }

        function searchApps(query) {
            const storeApps = document.getElementById('storeApps');
            storeApps.innerHTML = '';
            
            const filteredApps = appDatabase.filter(app => 
                app.name.toLowerCase().includes(query.toLowerCase()) ||
                app.developer.toLowerCase().includes(query.toLowerCase()) ||
                app.description.toLowerCase().includes(query.toLowerCase())
            );
            
            filteredApps.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'app-item';
                appItem.innerHTML = `
                    <div class="app-icon">${app.icon}</div>
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-developer">${app.developer}</div>
                        <div class="app-description">${app.description}</div>
                        <div class="app-rating">★★★★☆ ${app.rating} | ${app.size}</div>
                    </div>
                    <div class="app-actions">
                        <div class="app-button ${installedApps.has(app.id) ? 'installed' : ''}" 
                             onclick="installApp('${app.id}')">
                            ${installedApps.has(app.id) ? 'Установлено' : 'Установить'}
                        </div>
                        <div class="app-button" onclick="openApp('${app.id}')">Запустить</div>
                    </div>
                `;
                storeApps.appendChild(appItem);
            });
        }

        function refreshStore() {
            loadStoreApps();
            showNotification('Магазин приложений обновлен');
        }

        // Калькулятор
        function calcAction(action) {
            const display = document.getElementById('calcDisplay');
            
            if (action === 'clear') {
                calcDisplay = '0';
                calcExpression = '';
            } else if (action === 'ce') {
                calcDisplay = '0';
            } else if (action === 'backspace') {
                if (calcDisplay.length > 1) {
                    calcDisplay = calcDisplay.slice(0, -1);
                    calcExpression = calcExpression.slice(0, -1);
                } else {
                    calcDisplay = '0';
                    calcExpression = '';
                }
            } else if (action === '=') {
                try {
                    const result = eval(calcExpression);
                    calcDisplay = result.toString();
                    calcExpression = result.toString();
                } catch (error) {
                    calcDisplay = 'Ошибка';
                    calcExpression = '';
                }
            } else {
                if (calcDisplay === '0' && !isNaN(action)) {
                    calcDisplay = action;
                    calcExpression = action;
                } else {
                    calcDisplay += action;
                    calcExpression += action;
                }
            }
            
            display.textContent = calcDisplay;
        }

        // Paint функции
        let paintColor = '#000000';
        let paintTool = 'pencil';
        let isPainting = false;

        function setupPaintCanvas() {
            const canvas = document.getElementById('paintCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            canvas.addEventListener('mousedown', startPaint);
            canvas.addEventListener('mousemove', paint);
            canvas.addEventListener('mouseup', stopPaint);
            canvas.addEventListener('mouseout', stopPaint);
            
            function startPaint(e) {
                isPainting = true;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
            
            function paint(e) {
                if (!isPainting) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ctx.lineWidth = paintTool === 'brush' ? 8 : 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = paintColor;
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
            
            function stopPaint() {
                isPainting = false;
                ctx.beginPath();
            }
        }

        function selectPaintTool(tool) {
            paintTool = tool;
            document.getElementById('paintToolStatus').textContent = `Инструмент: ${getToolName(tool)}`;
        }

        function selectPaintColor(color) {
            paintColor = color;
        }

        function clearPaint() {
            const canvas = document.getElementById('paintCanvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function getToolName(tool) {
            const names = {
                'pencil': 'Карандаш',
                'brush': 'Кисть',
                'eraser': 'Ластик',
                'line': 'Линия',
                'rectangle': 'Прямоугольник',
                'circle': 'Круг'
            };
            return names[tool] || tool;
        }

        // Терминал
        function setupTerminal() {
            const terminalInput = document.getElementById('terminalInput');
            const terminalOutput = document.getElementById('terminalOutput');
            
            if (terminalInput) {
                terminalInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const command = this.value.trim();
                        const outputLine = document.createElement('div');
                        outputLine.innerHTML = `C:\\WINDOWS>${command}`;
                        terminalOutput.appendChild(outputLine);
                        
                        executeCommand(command);
                        this.value = '';
                        
                        terminalOutput.scrollTop = terminalOutput.scrollHeight;
                    }
                });
            }
        }

        function executeCommand(command) {
            const terminalOutput = document.getElementById('terminalOutput');
            const cmd = command.toLowerCase();
            let response = '';
            
            switch(cmd) {
                case 'dir':
                    response = ` Том в устройстве C имеет метку SYSTEM
 Серийный номер тома: 1A2B-3C4D

 Содержимое папки C:\\WINDOWS

16.07.1998  14:32    <DIR>          .
16.07.1998  14:32    <DIR>          ..
15.06.1998  12:00    <DIR>          SYSTEM
15.06.1998  12:00    <DIR>          SYSTEM32
15.06.1998  12:00    <DIR>          FONTS
15.06.1998  12:00    <DIR>          TEMP
15.06.1998  12:00       286,720    NOTEPAD.EXE
15.06.1998  12:00        32,768    CALC.EXE
15.06.1998  12:00     1,421,312    EXPLORER.EXE
               3 файлов      1,740,800 байт
               6 папок    245,760,000 байт свободно`;
                    break;
                case 'cls':
                    terminalOutput.innerHTML = '';
                    const promptLine = document.createElement('div');
                    promptLine.innerHTML = 'C:\\WINDOWS>';
                    terminalOutput.appendChild(promptLine);
                    return;
                case 'ver':
                    response = 'Microsoft Windows 98 [Версия 4.10.2222]';
                    break;
                case 'time':
                    response = `Текущее время: ${new Date().toLocaleTimeString()}`;
                    break;
                case 'date':
                    response = `Текущая дата: ${new Date().toLocaleDateString()}`;
                    break;
                case 'help':
                    response = `Доступные команды:
DIR     - Вывод списка файлов и папок
CLS     - Очистка экрана
VER     - Версия Windows
TIME    - Текущее время
DATE    - Текущая дата
HELP    - Справка по командам
EXIT    - Выход из командной строки
NOTEPAD - Запуск Блокнота
CALC    - Запуск Калькулятора
PAINT   - Запуск Paint`;
                    break;
                case 'exit':
                    closeWindow('terminal');
                    return;
                case 'notepad':
                    openApp('notepad');
                    response = 'Запуск Блокнота...';
                    break;
                case 'calc':
                    openApp('calculator');
                    response = 'Запуск Калькулятора...';
                    break;
                case 'paint':
                    openApp('paint');
                    response = 'Запуск Paint...';
                    break;
                default:
                    response = `'${command}' не является внутренней или внешней командой,
исполняемой программой или пакетным файлом.`;
            }
            
            const responseLine = document.createElement('div');
            responseLine.innerHTML = response.replace(/\n/g, '<br>');
            terminalOutput.appendChild(responseLine);
            
            const promptLine = document.createElement('div');
            promptLine.innerHTML = 'C:\\WINDOWS>';
            terminalOutput.appendChild(promptLine);
        }

        // Игровые функции
        function startDoomGame(appId) {
            showNotification('🎮 DOOM запущен! Rip and Tear!');
        }

        function startGame(appId) {
            const app = appDatabase.find(a => a.id === appId);
            showNotification(`🎮 ${app.name} запущен!`);
        }

        function newSolitaireGame() {
            showNotification('🃏 Новая игра пасьянса началась!');
        }

        function mediaPlayerAction(action) {
            const status = document.getElementById('mediaPlayerStatus');
            switch(action) {
                case 'play':
                    status.textContent = 'Воспроизведение';
                    showNotification('▶️ Воспроизведение');
                    break;
                case 'pause':
                    status.textContent = 'Пауза';
                    showNotification('⏸️ Пауза');
                    break;
                case 'stop':
                    status.textContent = 'Остановлено';
                    showNotification('⏹️ Остановлено');
                    break;
                case 'open':
                    showNotification('📂 Открыть файл');
                    break;
            }
        }

        // Меню Пуск
        function toggleStartMenu() {
            const startMenu = document.getElementById('startMenu');
            startMenu.classList.toggle('show');
        }

        // Системные функции
        function showDesktop() {
            document.querySelectorAll('.window').forEach(w => {
                w.style.display = 'none';
            });
            showNotification('🖥️ Рабочий стол показан');
        }

        function showVolumeControl() {
            showNotification('🔊 Громкость: 75%');
        }

        function showNetworkStatus() {
            showNotification('📶 Сеть: Подключено к Интернету');
        }

        function showAntivirus() {
            showNotification('🛡️ Norton AntiVirus: Система защищена');
        }

        function showRunDialog() {
            const command = prompt('Введите команду для запуска:');
            if (command) {
                const commands = {
                    'calc': 'calculator',
                    'notepad': 'notepad',
                    'paint': 'paint',
                    'iexplore': 'browser',
                    'explorer': 'filemanager'
                };
                
                if (commands[command.toLowerCase()]) {
                    openApp(commands[command.toLowerCase()]);
                } else {
                    showNotification(`Команда "${command}" не найдена`);
                }
            }
        }

        function showShutdown() {
            if (confirm('Завершить работу Windows?')) {
                document.body.style.background = '#000';
                document.body.innerHTML = '<div style="color: #00ff00; text-align: center; padding-top: 200px; font-size: 24px; font-family: monospace;">Система завершает работу...<br><br>Теперь компьютер можно выключить</div>';
            }
        }

        // Обработка иконок рабочего стола
        document.addEventListener('click', function(e) {
            const icon = e.target.closest('.desktop-icon');
            if (icon) {
                document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
                icon.classList.add('selected');
            } else if (e.target.closest('.desktop') && !e.target.closest('.window')) {
                document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
            }
        });

        document.addEventListener('dblclick', function(e) {
            const icon = e.target.closest('.desktop-icon');
            if (icon) {
                const appName = icon.dataset.app;
                openApp(appName);
            }
        });

        // Закрытие меню при клике вне его
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.start-button') && !e.target.closest('.start-menu')) {
                document.getElementById('startMenu').classList.remove('show');
            }
        });

        // Уведомления
        function showNotification(text) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationText').textContent = text;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Горячие клавиши
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F11') {
                e.preventDefault();
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
        });

        // Активация окна при клике
        document.addEventListener('mousedown', function(e) {
            const windowElement = e.target.closest('.window');
            if (windowElement) {
                activateWindow(windowElement);
            }
        });

        // Финальная инициализация
        setTimeout(() => {
            createSystemWindows();
            console.log('✅ Windows 98 Virtual Machine полностью загружена и готова к работе!');
        }, 1000);
    </script>
</body>
</html>

